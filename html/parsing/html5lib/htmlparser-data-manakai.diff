diff --git a/html/parsing/html5lib/html-tokenizer/xmlViolation.test b/html/parsing/html5lib/html-tokenizer/xmlViolation.test
index 137d964..d108c4c 100644
--- a/html/parsing/html5lib/html-tokenizer/xmlViolation.test
+++ b/html/parsing/html5lib/html-tokenizer/xmlViolation.test
@@ -3,16 +3,16 @@
 {"description":"Non-XML character",
 "input":"a\uFFFFb",
 "ignoreErrorOrder":true,
-"output":["ParseError",["Character","a\uFFFDb"]]},
+"output":["ParseError",["Character","a\uFFFFb"]]},
 
 {"description":"Non-XML space",
 "input":"a\u000Cb",
 "ignoreErrorOrder":true,
-"output":[["Character","a b"]]},
+"output":[["Character","a\u000Cb"]]},
 
 {"description":"Double hyphen in comment",
 "input":"<!-- foo -- bar -->",
-"output":["ParseError",["Comment"," foo - - bar "]]},
+"output":["ParseError",["Comment"," foo -- bar "]]},
 
 {"description":"FF between attributes",
 "input":"<a b=''\u000Cc=''>",
diff --git a/html/parsing/html5lib/html-tree/doctype01.dat b/html/parsing/html5lib/html-tree/doctype01.dat
index cec6638..d273730 100644
--- a/html/parsing/html5lib/html-tree/doctype01.dat
+++ b/html/parsing/html5lib/html-tree/doctype01.dat
@@ -303,6 +303,8 @@
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">Hello
 #errors
+#shoulds
+obsolete permitted
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -385,6 +387,8 @@
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">
 #errors
 (1,50): unexpected-char-in-doctype
+#shoulds
+obsolete permitted
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -395,6 +399,8 @@
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"'http://www.w3.org/TR/html4/strict.dtd'>
 #errors
 (1,50): unexpected-char-in-doctype
+#shoulds
+obsolete permitted
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -406,6 +412,8 @@
 #errors
 (1,21): unexpected-char-in-doctype
 (1,49): unexpected-char-in-doctype
+#shoulds
+obsolete permitted
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -417,6 +425,8 @@
 #errors
 (1,21): unexpected-char-in-doctype
 (1,49): unexpected-char-in-doctype
+#shoulds
+obsolete permitted
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
diff --git a/html/parsing/html5lib/html-tree/domjs-unsafe.dat b/html/parsing/html5lib/html-tree/domjs-unsafe.dat
index 34b4e62..0b1b737 100644
--- a/html/parsing/html5lib/html-tree/domjs-unsafe.dat
+++ b/html/parsing/html5lib/html-tree/domjs-unsafe.dat
@@ -439,8 +439,6 @@ bar"
 #errors
 (1,7): expected-doctype-but-got-start-tag
 (1,32): foster-parenting-character-in-table
-(1,32): foster-parenting-character-in-table
-(1,32): foster-parenting-character-in-table
 (1,32): unexpected-end-tag
 #document
 | <html>
diff --git a/html/parsing/html5lib/html-tree/entities01.dat b/html/parsing/html5lib/html-tree/entities01.dat
index b271f82..cd5b1db 100644
--- a/html/parsing/html5lib/html-tree/entities01.dat
+++ b/html/parsing/html5lib/html-tree/entities01.dat
@@ -763,6 +763,7 @@ FOO&#11111111111ZOO
 #errors
 (1,3): expected-doctype-but-got-chars
 (1,13): illegal-codepoint-for-numeric-entity
+no refc
 #document
 | <html>
 |   <head>
@@ -774,6 +775,7 @@ FOO&#1111111111ZOO
 #errors
 (1,3): expected-doctype-but-got-chars
 (1,13): illegal-codepoint-for-numeric-entity
+no refc
 #document
 | <html>
 |   <head>
@@ -785,6 +787,7 @@ FOO&#111111111111ZOO
 #errors
 (1,3): expected-doctype-but-got-chars
 (1,13): illegal-codepoint-for-numeric-entity
+no refc
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/entities02.dat b/html/parsing/html5lib/html-tree/entities02.dat
index 22365c9..b82647e 100644
--- a/html/parsing/html5lib/html-tree/entities02.dat
+++ b/html/parsing/html5lib/html-tree/entities02.dat
@@ -285,6 +285,8 @@
 #data
 <div>ZZ&AElig=</div>
 #errors
+no DOCTYPE
+no refc
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/foreign-fragment.dat b/html/parsing/html5lib/html-tree/foreign-fragment.dat
index 2e3cb6c..07584cc 100644
--- a/html/parsing/html5lib/html-tree/foreign-fragment.dat
+++ b/html/parsing/html5lib/html-tree/foreign-fragment.dat
@@ -3,7 +3,6 @@
 #errors
 6: HTML start tag “nobr” in a foreign namespace context.
 7: End of file seen and there were open elements.
-6: Unclosed element “nobr”.
 #document-fragment
 svg path
 #document
@@ -173,7 +172,6 @@ math ms
 #errors
 51: Self-closing syntax (“/>”) used on a non-void HTML element. Ignoring the slash and treating as a start tag.
 52: End of file seen and there were open elements.
-51: Unclosed element “ms”.
 #document-fragment
 math ms
 #document
@@ -214,7 +212,6 @@ math ms
 #errors
 51: Self-closing syntax (“/>”) used on a non-void HTML element. Ignoring the slash and treating as a start tag.
 52: End of file seen and there were open elements.
-51: Unclosed element “mn”.
 #document-fragment
 math mn
 #document
@@ -255,7 +252,6 @@ math mn
 #errors
 51: Self-closing syntax (“/>”) used on a non-void HTML element. Ignoring the slash and treating as a start tag.
 52: End of file seen and there were open elements.
-51: Unclosed element “mo”.
 #document-fragment
 math mo
 #document
@@ -296,7 +292,6 @@ math mo
 #errors
 51: Self-closing syntax (“/>”) used on a non-void HTML element. Ignoring the slash and treating as a start tag.
 52: End of file seen and there were open elements.
-51: Unclosed element “mi”.
 #document-fragment
 math mi
 #document
@@ -337,7 +332,6 @@ math mi
 #errors
 51: Self-closing syntax (“/>”) used on a non-void HTML element. Ignoring the slash and treating as a start tag.
 52: End of file seen and there were open elements.
-51: Unclosed element “mtext”.
 #document-fragment
 math mtext
 #document
@@ -488,7 +482,6 @@ svg desc
 <plaintext><foo>
 #errors
 16: End of file seen and there were open elements.
-11: Unclosed element “plaintext”.
 #document-fragment
 svg desc
 #document
diff --git a/html/parsing/html5lib/html-tree/isindex.dat b/html/parsing/html5lib/html-tree/isindex.dat
index 42ef997..3281944 100644
--- a/html/parsing/html5lib/html-tree/isindex.dat
+++ b/html/parsing/html5lib/html-tree/isindex.dat
@@ -2,46 +2,36 @@
 <isindex>
 #errors
 (1,9): expected-doctype-but-got-start-tag
-(1,9): deprecated-tag
+EOF
 #document
 | <html>
 |   <head>
 |   <body>
-|     <form>
-|       <hr>
-|       <label>
-|         "This is a searchable index. Enter search keywords: "
-|         <input>
-|           name="isindex"
-|       <hr>
+|     <isindex>
 
 #data
 <isindex name="A" action="B" prompt="C" foo="D">
 #errors
 (1,48): expected-doctype-but-got-start-tag
-(1,48): deprecated-tag
+EOF
 #document
 | <html>
 |   <head>
 |   <body>
-|     <form>
+|     <isindex>
 |       action="B"
-|       <hr>
-|       <label>
-|         "C"
-|         <input>
-|           foo="D"
-|           name="isindex"
-|       <hr>
+|       foo="D"
+|       name="A"
+|       prompt="C"
 
 #data
 <form><isindex>
 #errors
 (1,6): expected-doctype-but-got-start-tag
-(1,15): deprecated-tag
 (1,15): expected-closing-tag-but-got-eof
 #document
 | <html>
 |   <head>
 |   <body>
 |     <form>
+|       <isindex>
diff --git a/html/parsing/html5lib/html-tree/math.dat b/html/parsing/html5lib/html-tree/math.dat
index ae9cd7c..666148f 100644
--- a/html/parsing/html5lib/html-tree/math.dat
+++ b/html/parsing/html5lib/html-tree/math.dat
@@ -1,6 +1,8 @@
 #data
 <math><tr><td><mo><tr>
 #errors
+bad <tr>
+EOF
 #document-fragment
 td
 #document
@@ -12,6 +14,9 @@ td
 #data
 <math><tr><td><mo><tr>
 #errors
+<math> in table
+bad <tr>
+EOF
 #document-fragment
 tr
 #document
@@ -23,6 +28,9 @@ tr
 #data
 <math><thead><mo><tbody>
 #errors
+<math> in table
+bad <tbody>
+EOF
 #document-fragment
 thead
 #document
@@ -33,6 +41,9 @@ thead
 #data
 <math><tfoot><mo><tbody>
 #errors
+<math> in table
+bad <tfoot>
+EOF
 #document-fragment
 tfoot
 #document
@@ -43,6 +54,9 @@ tfoot
 #data
 <math><tbody><mo><tfoot>
 #errors
+<math> in table
+bad <tfoot>
+EOF
 #document-fragment
 tbody
 #document
@@ -53,6 +67,10 @@ tbody
 #data
 <math><tbody><mo></table>
 #errors
+<math> in table
+no </math>
+bad </table>
+no </mo>
 #document-fragment
 tbody
 #document
@@ -63,6 +81,10 @@ tbody
 #data
 <math><thead><mo></table>
 #errors
+<math> in table
+no </math>
+bad </table>
+no </mo>
 #document-fragment
 tbody
 #document
@@ -73,6 +95,10 @@ tbody
 #data
 <math><tfoot><mo></table>
 #errors
+<math> in table
+no </math>
+bad </table>
+no </mo>
 #document-fragment
 tbody
 #document
diff --git a/html/parsing/html5lib/html-tree/namespace-sensitivity.dat b/html/parsing/html5lib/html-tree/namespace-sensitivity.dat
index ca35c0e..ff0eade 100644
--- a/html/parsing/html5lib/html-tree/namespace-sensitivity.dat
+++ b/html/parsing/html5lib/html-tree/namespace-sensitivity.dat
@@ -1,6 +1,10 @@
 #data
 <body><table><tr><td><svg><td><foreignObject><span></td>Foo
 #errors
+no DOCTYPE
+no </span>
+text in table
+EOF
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/pending-spec-changes-plain-text-unsafe.dat b/html/parsing/html5lib/html-tree/pending-spec-changes-plain-text-unsafe.dat
index 3ee8cec..f287b31 100644
--- a/html/parsing/html5lib/html-tree/pending-spec-changes-plain-text-unsafe.dat
+++ b/html/parsing/html5lib/html-tree/pending-spec-changes-plain-text-unsafe.dat
@@ -9,15 +9,6 @@
 (1,26): invalid-codepoint
 (1,26): invalid-codepoint-in-table-text
 (1,26): foster-parenting-character-in-table
-(1,26): foster-parenting-character-in-table
-(1,26): foster-parenting-character-in-table
-(1,26): foster-parenting-character-in-table
-(1,26): foster-parenting-character-in-table
-(1,26): foster-parenting-character-in-table
-(1,26): foster-parenting-character-in-table
-(1,26): foster-parenting-character-in-table
-(1,26): foster-parenting-character-in-table
-(1,26): foster-parenting-character-in-table
 (1,26): eof-in-table
 #document
 | <html>
diff --git a/html/parsing/html5lib/html-tree/plain-text-unsafe.dat b/html/parsing/html5lib/html-tree/plain-text-unsafe.dat
index f40dd57..cf72889 100644
--- a/html/parsing/html5lib/html-tree/plain-text-unsafe.dat
+++ b/html/parsing/html5lib/html-tree/plain-text-unsafe.dat
@@ -3,11 +3,11 @@ FOO&#x000D;ZOO
 #errors
 (1,3): expected-doctype-but-got-chars
 (1,11): illegal-codepoint-for-numeric-entity
-#document
+#document escaped
 | <html>
 |   <head>
 |   <body>
-|     "FOOZOO"
+|     "FOO\u000DZOO"
 
 #data
 <html> <frameset></frameset>
diff --git a/html/parsing/html5lib/html-tree/ruby.dat b/html/parsing/html5lib/html-tree/ruby.dat
index 1ca8016..d9b1fc8 100644
--- a/html/parsing/html5lib/html-tree/ruby.dat
+++ b/html/parsing/html5lib/html-tree/ruby.dat
@@ -58,6 +58,7 @@
 <html><ruby>a<rb>b<span></ruby></html>
 #errors
 (1,6): expected-doctype-but-got-start-tag
+no </span>
 #document
 | <html>
 |   <head>
@@ -128,6 +129,7 @@
 <html><ruby>a<rt>b<span></ruby></html>
 #errors
 (1,6): expected-doctype-but-got-start-tag
+no </span>
 #document
 | <html>
 |   <head>
@@ -201,6 +203,7 @@
 <html><ruby>a<rtc>b<span></ruby></html>
 #errors
 (1,6): expected-doctype-but-got-start-tag
+no </span>
 #document
 | <html>
 |   <head>
@@ -271,6 +274,7 @@
 <html><ruby>a<rp>b<span></ruby></html>
 #errors
 (1,6): expected-doctype-but-got-start-tag
+no </span>
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tables01.dat b/html/parsing/html5lib/html-tree/tables01.dat
index f0caaa3..39303dd 100644
--- a/html/parsing/html5lib/html-tree/tables01.dat
+++ b/html/parsing/html5lib/html-tree/tables01.dat
@@ -48,8 +48,6 @@
 (1,7): expected-doctype-but-got-start-tag
 (1,24): unexpected-end-tag
 (1,27): foster-parenting-character-in-table
-(1,27): foster-parenting-character-in-table
-(1,27): foster-parenting-character-in-table
 (1,27): eof-in-table
 #document
 | <html>
diff --git a/html/parsing/html5lib/html-tree/template.dat b/html/parsing/html5lib/html-tree/template.dat
index 690f605..61a62c4 100644
--- a/html/parsing/html5lib/html-tree/template.dat
+++ b/html/parsing/html5lib/html-tree/template.dat
@@ -1090,6 +1090,10 @@ eof in template
 #errors
 no doctype
 unexpected text
+e
+l
+l
+o
 eof in template
 #document
 | <html>
@@ -1346,8 +1350,6 @@ eof in template
 #errors
 no doctype
 foster-parenting text F
-foster-parenting text o
-foster-parenting text o
 eof
 eof
 #document
@@ -1593,6 +1595,11 @@ eof table
 #data
 <template><a><table><a>
 #errors
+no DOCTYPE
+<a> in table
+<a> in <a>
+AAA by <a>
+EOF
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tests1.dat b/html/parsing/html5lib/html-tree/tests1.dat
index d6726e3..4e17fcb 100644
--- a/html/parsing/html5lib/html-tree/tests1.dat
+++ b/html/parsing/html5lib/html-tree/tests1.dat
@@ -357,7 +357,6 @@ Line1<br>Line2<br>Line3<br>Line4
 (1,27): unexpected-select-in-select
 (1,39): unexpected-end-tag
 (1,48): unexpected-end-tag
-(1,49): expected-closing-tag-but-got-eof
 #document
 | <html>
 |   <head>
@@ -425,17 +424,9 @@ Line1<br>Line2<br>Line3<br>Line4
 #errors
 (1,7): unexpected-dash-after-double-dash-in-comment
 (1,14): expected-doctype-but-got-start-tag
+foster-parenting-char
 (1,41): unexpected-start-tag-implies-table-voodoo
 (1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
 (1,48): unexpected-cell-in-table-body
 (1,63): unexpected-cell-end-tag
 (1,71): eof-in-table
@@ -838,7 +829,7 @@ Line1<br>Line2<br>Line3<br>Line4
 |       "D"
 
 #data
-
+| 
 #errors
 (1,0): expected-doctype-but-got-eof
 #document
@@ -1125,7 +1116,6 @@ Line1<br>Line2<br>Line3<br>Line4
 (1,39): unexpected-start-tag-implies-end-tag
 (1,39): unexpected-end-tag
 (1,45): foster-parenting-character-in-table
-(1,45): foster-parenting-character-in-table
 (1,68): foster-parenting-character-in-table
 (1,71): expected-closing-tag-but-got-eof
 #document
@@ -1178,8 +1168,6 @@ Line1<br>Line2<br>Line3<br>Line4
 (1,7): expected-doctype-but-got-start-tag
 (1,22): unexpected-start-tag-implies-table-voodoo
 (1,29): foster-parenting-character-in-table
-(1,29): foster-parenting-character-in-table
-(1,29): foster-parenting-character-in-table
 (1,54): unexpected-cell-end-tag
 (1,68): foster-parenting-character-in-table
 (1,71): expected-closing-tag-but-got-eof
@@ -1539,7 +1527,6 @@ Line1<br>Line2<br>Line3<br>Line4
 (1,27): unexpected-select-in-select
 (1,39): unexpected-end-tag
 (1,48): unexpected-end-tag
-(1,48): expected-closing-tag-but-got-eof
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tests10.dat b/html/parsing/html5lib/html-tree/tests10.dat
index 3e9a9f1..f782161 100644
--- a/html/parsing/html5lib/html-tree/tests10.dat
+++ b/html/parsing/html5lib/html-tree/tests10.dat
@@ -236,9 +236,7 @@
 (1,43) foster-parenting-start-tag svg
 (1,66) unexpected HTML-like start tag token in foreign content
 (1,66) foster-parenting-start-tag
-(1,67) foster-parenting-character
-(1,68) foster-parenting-character
-(1,69) foster-parenting-character
+foster-parenting-char
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests15.dat b/html/parsing/html5lib/html-tree/tests15.dat
index 93d06a8..f9f68c4 100644
--- a/html/parsing/html5lib/html-tree/tests15.dat
+++ b/html/parsing/html5lib/html-tree/tests15.dat
@@ -91,7 +91,6 @@
 <!doctype html><table> X<meta></table>
 #errors
 (1,23): foster-parenting-character
-(1,24): foster-parenting-character
 (1,30): foster-parenting-start-character
 #document
 | <!DOCTYPE html>
@@ -106,7 +105,6 @@
 <!doctype html><table> x</table>
 #errors
 (1,23): foster-parenting-character
-(1,24): foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -119,8 +117,6 @@
 <!doctype html><table> x </table>
 #errors
 (1,23): foster-parenting-character
-(1,24): foster-parenting-character
-(1,25): foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -133,7 +129,6 @@
 <!doctype html><table><tr> x</table>
 #errors
 (1,27): foster-parenting-character
-(1,28): foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -164,8 +159,6 @@
 #errors
 (1,30): foster-parenting-start-tag
 (1,31): foster-parenting-character
-(1,32): foster-parenting-character
-(1,33): foster-parenting-character
 (1,37): foster-parenting-end-tag
 #document
 | <!DOCTYPE html>
diff --git a/html/parsing/html5lib/html-tree/tests16.dat b/html/parsing/html5lib/html-tree/tests16.dat
index 1219157..897f86f 100644
--- a/html/parsing/html5lib/html-tree/tests16.dat
+++ b/html/parsing/html5lib/html-tree/tests16.dat
@@ -2407,8 +2407,8 @@
 |     "-->"
 
 #data
-<!doctype html><table>
-
+| <!doctype html><table>
+| 
 #errors
 (2,0): eof-in-table
 #document
@@ -2446,7 +2446,6 @@
 (1,35): unexpected-end-tag-implies-table-voodoo
 (1,35): unexpected-end-tag
 (1,41): unexpected-form-in-table
-(1,56): unexpected-end-tag
 (1,56): expected-closing-tag-but-got-eof
 #document
 | <!DOCTYPE html>
diff --git a/html/parsing/html5lib/html-tree/tests18.dat b/html/parsing/html5lib/html-tree/tests18.dat
index 926bccb..9561bf6 100644
--- a/html/parsing/html5lib/html-tree/tests18.dat
+++ b/html/parsing/html5lib/html-tree/tests18.dat
@@ -14,17 +14,6 @@
 <!doctype html><table><plaintext></plaintext>
 #errors
 (1,33): foster-parenting-start-tag
-(1,34): foster-parenting-character
-(1,35): foster-parenting-character
-(1,36): foster-parenting-character
-(1,37): foster-parenting-character
-(1,38): foster-parenting-character
-(1,39): foster-parenting-character
-(1,40): foster-parenting-character
-(1,41): foster-parenting-character
-(1,42): foster-parenting-character
-(1,43): foster-parenting-character
-(1,44): foster-parenting-character
 (1,45): foster-parenting-character
 (1,45): eof-in-table
 #document
@@ -41,17 +30,6 @@
 #errors
 (1,40): foster-parenting-start-tag
 (1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
 (1,52): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -68,17 +46,6 @@
 #errors
 (1,44): foster-parenting-start-tag
 (1,45): foster-parenting-character
-(1,46): foster-parenting-character
-(1,47): foster-parenting-character
-(1,48): foster-parenting-character
-(1,49): foster-parenting-character
-(1,50): foster-parenting-character
-(1,51): foster-parenting-character
-(1,52): foster-parenting-character
-(1,53): foster-parenting-character
-(1,54): foster-parenting-character
-(1,55): foster-parenting-character
-(1,56): foster-parenting-character
 (1,56): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -126,8 +93,6 @@
 <!doctype html><table><tr><style></script></style>abc
 #errors
 (1,51): foster-parenting-character
-(1,52): foster-parenting-character
-(1,53): foster-parenting-character
 (1,53): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -145,8 +110,6 @@
 <!doctype html><table><tr><script></style></script>abc
 #errors
 (1,52): foster-parenting-character
-(1,53): foster-parenting-character
-(1,54): foster-parenting-character
 (1,54): eof-in-table
 #document
 | <!DOCTYPE html>
diff --git a/html/parsing/html5lib/html-tree/tests19.dat b/html/parsing/html5lib/html-tree/tests19.dat
index 02158c8..50eb305 100644
--- a/html/parsing/html5lib/html-tree/tests19.dat
+++ b/html/parsing/html5lib/html-tree/tests19.dat
@@ -84,7 +84,6 @@
 #data
 <!doctype html><form><isindex>
 #errors
-(1,30): deprecated-tag
 (1,30): expected-closing-tag-but-got-eof
 #document
 | <!DOCTYPE html>
@@ -92,6 +91,7 @@
 |   <head>
 |   <body>
 |     <form>
+|       <isindex>
 
 #data
 <!doctype html><isindex action="POST">
@@ -102,14 +102,8 @@
 | <html>
 |   <head>
 |   <body>
-|     <form>
+|     <isindex>
 |       action="POST"
-|       <hr>
-|       <label>
-|         "This is a searchable index. Enter search keywords: "
-|         <input>
-|           name="isindex"
-|       <hr>
 
 #data
 <!doctype html><isindex prompt="this is isindex">
@@ -120,13 +114,8 @@
 | <html>
 |   <head>
 |   <body>
-|     <form>
-|       <hr>
-|       <label>
-|         "this is isindex"
-|         <input>
-|           name="isindex"
-|       <hr>
+|     <isindex>
+|       prompt="this is isindex"
 
 #data
 <!doctype html><isindex type="hidden">
@@ -137,14 +126,8 @@
 | <html>
 |   <head>
 |   <body>
-|     <form>
-|       <hr>
-|       <label>
-|         "This is a searchable index. Enter search keywords: "
-|         <input>
-|           name="isindex"
-|           type="hidden"
-|       <hr>
+|     <isindex>
+|       type="hidden"
 
 #data
 <!doctype html><isindex name="foo">
@@ -155,13 +138,8 @@
 | <html>
 |   <head>
 |   <body>
-|     <form>
-|       <hr>
-|       <label>
-|         "This is a searchable index. Enter search keywords: "
-|         <input>
-|           name="isindex"
-|       <hr>
+|     <isindex>
+|       name="foo"
 
 #data
 <!doctype html><ruby><p><rp>
@@ -390,8 +368,6 @@
 <!doctype html><table>abc<!--foo-->
 #errors
 (1,23): foster-parenting-character
-(1,24): foster-parenting-character
-(1,25): foster-parenting-character
 (1,35): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -419,8 +395,6 @@
 <!doctype html><table> b <!--foo-->
 #errors
 (1,23): foster-parenting-character
-(1,24): foster-parenting-character
-(1,25): foster-parenting-character
 (1,35): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -1116,7 +1090,6 @@
 <!doctype html><math></html>
 #errors
 (1,28): unexpected-end-tag
-(1,28): expected-one-end-tag-but-got-another
 (1,28): unexpected-end-tag
 #document
 | <!DOCTYPE html>
@@ -1176,6 +1149,8 @@
 <!doctype html><image/>
 #errors
 (1,23): image-start-tag
+#warnings
+nestc
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests2.dat b/html/parsing/html5lib/html-tree/tests2.dat
index 4195316..6f12199 100644
--- a/html/parsing/html5lib/html-tree/tests2.dat
+++ b/html/parsing/html5lib/html-tree/tests2.dat
@@ -162,9 +162,6 @@
 (1,7): expected-doctype-but-got-start-tag
 (1,18): unexpected-start-tag-implies-table-voodoo
 (1,22): foster-parenting-character-in-table
-(1,22): foster-parenting-character-in-table
-(1,22): foster-parenting-character-in-table
-(1,22): foster-parenting-character-in-table
 (1,22): eof-in-table
 #document
 | <html>
@@ -190,9 +187,6 @@
 <!DOCTYPE html><table><tr>TEST
 #errors
 (1,30): foster-parenting-character-in-table
-(1,30): foster-parenting-character-in-table
-(1,30): foster-parenting-character-in-table
-(1,30): foster-parenting-character-in-table
 (1,30): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -471,7 +465,6 @@
 <!DOCTYPE html><select><optgroup><option></optgroup><option><select><option>
 #errors
 (1,68): unexpected-select-in-select
-(1,76): expected-closing-tag-but-got-eof
 #document
 | <!DOCTYPE html>
 | <html>
@@ -562,14 +555,9 @@
 | <html>
 |   <head>
 |   <body>
-|     <form>
-|       <hr>
-|       <label>
-|         "This is a searchable index. Enter search keywords: "
-|         <input>
-|           name="isindex"
-|           test="x"
-|       <hr>
+|     <isindex>
+|       name="x"
+|       test="x"
 
 #data
 test
diff --git a/html/parsing/html5lib/html-tree/tests20.dat b/html/parsing/html5lib/html-tree/tests20.dat
index 52c5acd..ca91149 100644
--- a/html/parsing/html5lib/html-tree/tests20.dat
+++ b/html/parsing/html5lib/html-tree/tests20.dat
@@ -407,7 +407,6 @@
 <option><option>
 #errors
 (1,8): expected-doctype-but-got-start-tag
-(1,16): expected-closing-tag-but-got-eof
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tests21.dat b/html/parsing/html5lib/html-tree/tests21.dat
index d384a55..1482c70 100644
--- a/html/parsing/html5lib/html-tree/tests21.dat
+++ b/html/parsing/html5lib/html-tree/tests21.dat
@@ -39,6 +39,7 @@
 <svg><![CDATA[foo
 #errors
 (1,5): expected-doctype-but-got-start-tag
+EOF (tokenizer)
 (1,17): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -51,6 +52,7 @@
 <svg><![CDATA[foo
 #errors
 (1,5): expected-doctype-but-got-start-tag
+EOF (tokenizer)
 (1,17): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -63,6 +65,7 @@
 <svg><![CDATA[
 #errors
 (1,5): expected-doctype-but-got-start-tag
+EOF (tokenizer)
 (1,14): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -109,6 +112,7 @@
 <svg><![CDATA[]]
 #errors
 (1,5): expected-doctype-but-got-start-tag
+EOF (tokenizer)
 (1,16): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -121,6 +125,7 @@
 <svg><![CDATA[]
 #errors
 (1,5): expected-doctype-but-got-start-tag
+EOF (tokenizer)
 (1,15): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -133,6 +138,7 @@
 <svg><![CDATA[]>a
 #errors
 (1,5): expected-doctype-but-got-start-tag
+EOF (tokenizer)
 (1,17): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -220,6 +226,7 @@
 <svg><![CDATA[<svg>a
 #errors
 (1,5): expected-doctype-but-got-start-tag
+EOF (tokenizer)
 (1,20): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -232,6 +239,7 @@
 <svg><![CDATA[</svg>a
 #errors
 (1,5): expected-doctype-but-got-start-tag
+EOF (tokenizer)
 (1,21): expected-closing-tag-but-got-eof
 #document
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests26.dat b/html/parsing/html5lib/html-tree/tests26.dat
index 8964624..b9e82d1 100644
--- a/html/parsing/html5lib/html-tree/tests26.dat
+++ b/html/parsing/html5lib/html-tree/tests26.dat
@@ -261,8 +261,8 @@
 |         "2"
 
 #data
-<p><code x</code></p>
-
+| <p><code x</code></p>
+| 
 #errors
 (1,3): expected-doctype-but-got-start-tag
 (1,11): invalid-character-in-attribute-name
diff --git a/html/parsing/html5lib/html-tree/tests6.dat b/html/parsing/html5lib/html-tree/tests6.dat
index d774fc2..5027dc4 100644
--- a/html/parsing/html5lib/html-tree/tests6.dat
+++ b/html/parsing/html5lib/html-tree/tests6.dat
@@ -335,8 +335,6 @@ td
 #errors
 (1,7): expected-doctype-but-got-start-tag
 (1,18): foster-parenting-character-in-table
-(1,19): foster-parenting-character-in-table
-(1,20): foster-parenting-character-in-table
 (1,20): eof-in-table
 #document
 | <html>
@@ -600,6 +598,8 @@ html
 #data
 <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html></html>
 #errors
+#shoulds
+obsolete permitted
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "">
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests7.dat b/html/parsing/html5lib/html-tree/tests7.dat
index 78fb6fa..20209e1 100644
--- a/html/parsing/html5lib/html-tree/tests7.dat
+++ b/html/parsing/html5lib/html-tree/tests7.dat
@@ -350,8 +350,6 @@ html
 (1,7): expected-doctype-but-got-start-tag
 (1,10): foster-parenting-start-tag
 (1,32): foster-parenting-character
-(1,33): foster-parenting-character
-(1,34): foster-parenting-character
 (1,45): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -373,9 +371,7 @@ A<table><tr> B</tr> B</table>
 #errors
 (1,1): expected-doctype-but-got-chars
 (1,13): foster-parenting-character
-(1,14): foster-parenting-character
 (1,20): foster-parenting-character
-(1,21): foster-parenting-character
 #document
 | <html>
 |   <head>
@@ -390,7 +386,6 @@ A<table><tr> B</tr> </em>C</table>
 #errors
 (1,1): expected-doctype-but-got-chars
 (1,13): foster-parenting-character
-(1,14): foster-parenting-character
 (1,20): foster-parenting-character
 (1,25): unexpected-end-tag
 (1,26): foster-parenting-character
diff --git a/html/parsing/html5lib/html-tree/tests9.dat b/html/parsing/html5lib/html-tree/tests9.dat
index f8d04b2..8693600 100644
--- a/html/parsing/html5lib/html-tree/tests9.dat
+++ b/html/parsing/html5lib/html-tree/tests9.dat
@@ -87,8 +87,6 @@
 #errors
 (1,34) foster-parenting-start-token
 (1,39) foster-parenting-character
-(1,40) foster-parenting-character
-(1,41) foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -104,11 +102,7 @@
 #errors
 (1,34) foster-parenting-start-tag
 (1,39) foster-parenting-character
-(1,40) foster-parenting-character
-(1,41) foster-parenting-character
 (1,51) foster-parenting-character
-(1,52) foster-parenting-character
-(1,53) foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -126,11 +120,7 @@
 #errors
 (1,41) foster-parenting-start-tag
 (1,46) foster-parenting-character
-(1,47) foster-parenting-character
-(1,48) foster-parenting-character
 (1,58) foster-parenting-character
-(1,59) foster-parenting-character
-(1,60) foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -149,11 +139,7 @@
 #errors
 (1,45) foster-parenting-start-tag
 (1,50) foster-parenting-character
-(1,51) foster-parenting-character
-(1,52) foster-parenting-character
 (1,62) foster-parenting-character
-(1,63) foster-parenting-character
-(1,64) foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -271,16 +257,10 @@
 #errors
 (1,44) foster-parenting-start-tag
 (1,49) foster-parenting-character
-(1,50) foster-parenting-character
-(1,51) foster-parenting-character
 (1,61) foster-parenting-character
-(1,62) foster-parenting-character
-(1,63) foster-parenting-character
 (1,71) unexpected-html-element-in-foreign-content
 (1,71) foster-parenting-start-tag
 (1,63) foster-parenting-character
-(1,63) foster-parenting-character
-(1,63) foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests_innerHTML_1.dat b/html/parsing/html5lib/html-tree/tests_innerHTML_1.dat
index 9c5c182..8af0cda 100644
--- a/html/parsing/html5lib/html-tree/tests_innerHTML_1.dat
+++ b/html/parsing/html5lib/html-tree/tests_innerHTML_1.dat
@@ -826,7 +826,6 @@ td
 </select><option>
 #errors
 (1,9): XXX-undefined-error
-(1,17): eof-in-select
 #document-fragment
 select
 #document
@@ -836,7 +835,6 @@ select
 <input><option>
 #errors
 (1,7): unexpected-input-in-select
-(1,15): eof-in-select
 #document-fragment
 select
 #document
@@ -846,7 +844,6 @@ select
 <keygen><option>
 #errors
 (1,8): unexpected-input-in-select
-(1,16): eof-in-select
 #document-fragment
 select
 #document
@@ -855,8 +852,7 @@ select
 #data
 <textarea><option>
 #errors
-(1,10): unexpected-input-in-select
-(1,18): eof-in-select
+(1,1): unexpected-textarea-in-select
 #document-fragment
 select
 #document
diff --git a/html/parsing/html5lib/html-tree/tricky01.dat b/html/parsing/html5lib/html-tree/tricky01.dat
index 753502a..98f4645 100644
--- a/html/parsing/html5lib/html-tree/tricky01.dat
+++ b/html/parsing/html5lib/html-tree/tricky01.dat
@@ -209,30 +209,6 @@ Also not bold."
 (1,20): unexpected-start-tag-implies-table-voodoo
 (1,20): closing-non-current-p-element
 (1,21): foster-parenting-character
-(1,22): foster-parenting-character
-(1,23): foster-parenting-character
-(1,24): foster-parenting-character
-(1,25): foster-parenting-character
-(1,26): foster-parenting-character
-(1,27): foster-parenting-character
-(1,28): foster-parenting-character
-(1,29): foster-parenting-character
-(1,30): foster-parenting-character
-(1,31): foster-parenting-character
-(1,32): foster-parenting-character
-(1,33): foster-parenting-character
-(1,34): foster-parenting-character
-(1,35): foster-parenting-character
-(1,36): foster-parenting-character
-(1,37): foster-parenting-character
-(1,38): foster-parenting-character
-(1,39): foster-parenting-character
-(1,40): foster-parenting-character
-(1,41): foster-parenting-character
-(1,42): foster-parenting-character
-(1,43): foster-parenting-character
-(1,44): foster-parenting-character
-(1,45): foster-parenting-character
 (1,45): eof-in-table
 #document
 | <html>
diff --git a/html/parsing/html5lib/html-tree/webkit01.dat b/html/parsing/html5lib/html-tree/webkit01.dat
index f1cd858..e32f28a 100644
--- a/html/parsing/html5lib/html-tree/webkit01.dat
+++ b/html/parsing/html5lib/html-tree/webkit01.dat
@@ -385,7 +385,6 @@ console.log("FOO<span>BAR</span>BAZ");
 (1,59): unexpected-select-in-select
 (1,93): unexpected-select-in-select
 (1,127): unexpected-select-in-select
-(1,127): expected-closing-tag-but-got-eof
 #document
 | <html>
 |   <head>
@@ -653,6 +652,10 @@ console.log("FOO<span>BAR</span>BAZ");
 #data
 <table><tr><td><svg><desc><td></desc><circle>
 #errors
+no DOCTYPE
+<td> bad context
+bad </desc>
+EOF
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/webkit02.dat b/html/parsing/html5lib/html-tree/webkit02.dat
index d9ef820..4b48da7 100644
--- a/html/parsing/html5lib/html-tree/webkit02.dat
+++ b/html/parsing/html5lib/html-tree/webkit02.dat
@@ -136,6 +136,7 @@
 #data
 <legend>test</legend>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -146,6 +147,9 @@
 #data
 <table><input>
 #errors
+no DOCTYPE
+<input> in table
+EOF
 #document
 | <html>
 |   <head>
@@ -156,6 +160,9 @@
 #data
 <b><em><foo><foo><aside></b>
 #errors
+no DOCTYPE
+AAA
+EOF
 #document
 | <html>
 |   <head>
@@ -171,6 +178,10 @@
 #data
 <b><em><foo><foo><aside></b></em>
 #errors
+no DOCTYPE
+AAA
+AAA
+EOF
 #document
 | <html>
 |   <head>
@@ -187,6 +198,9 @@
 #data
 <b><em><foo><foo><foo><aside></b>
 #errors
+no DOCTYPE
+AAA
+EOF
 #document
 | <html>
 |   <head>
@@ -202,6 +216,10 @@
 #data
 <b><em><foo><foo><foo><aside></b></em>
 #errors
+no DOCTYPE
+AAA
+bad </em>
+EOF
 #document
 | <html>
 |   <head>
@@ -217,6 +235,9 @@
 #data
 <b><em><foo><foo><foo><foo><foo><foo><foo><foo><foo><foo><aside></b></em>
 #errors
+AAA
+no </em>
+EOF
 #document-fragment
 div
 #document
@@ -238,6 +259,9 @@ div
 #data
 <b><em><foo><foob><foob><foob><foob><fooc><fooc><fooc><fooc><food><aside></b></em>
 #errors
+AAA
+bad </em>
+EOF
 #document-fragment
 div
 #document
@@ -259,21 +283,19 @@ div
 #data
 <isindex action="x">
 #errors
+<isindex> in table
+no </isindex>
 #document-fragment
 table
 #document
-| <form>
+| <isindex>
 |   action="x"
-|   <hr>
-|   <label>
-|     "This is a searchable index. Enter search keywords: "
-|     <input>
-|       name="isindex"
-|   <hr>
 
 #data
 <option><XH<optgroup></optgroup>
 #errors
+<xH<optgroup> in select
+bad </optgroup>
 #document-fragment
 select
 #document
@@ -282,6 +304,8 @@ select
 #data
 <svg><foreignObject><div>foo</div><plaintext></foreignObject></svg><div>bar</div>
 #errors
+no DOCTYPE
+no </plaintext>
 #document
 | <html>
 |   <head>
@@ -296,6 +320,8 @@ select
 #data
 <svg><foreignObject></foreignObject><title></svg>foo
 #errors
+no DOCTYPE
+no </title>
 #document
 | <html>
 |   <head>
@@ -308,6 +334,9 @@ select
 #data
 </foreignObject><plaintext><div>foo</div>
 #errors
+no DOCTYPE
+bad </foreignObject>
+no EOF
 #document
 | <html>
 |   <head>
