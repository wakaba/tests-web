diff --git a/html/parsing/html5lib/html-tokenizer/unicodeCharsProblematic.test b/html/parsing/html5lib/html-tokenizer/unicodeCharsProblematic.test
index 5987845..accd2ae 100644
--- a/html/parsing/html5lib/html-tokenizer/unicodeCharsProblematic.test
+++ b/html/parsing/html5lib/html-tokenizer/unicodeCharsProblematic.test
@@ -2,22 +2,22 @@
 {"description": "Invalid Unicode character U+DFFF",
 "doubleEscaped":true,
 "input": "\\uDFFF",
-"output":["ParseError", ["Character", "\\uFFFD"]]},
+"output":["ParseError", ["Character", "\\uDFFF"]]},
 
 {"description": "Invalid Unicode character U+D800",
 "doubleEscaped":true,
 "input": "\\uD800",
-"output":["ParseError", ["Character", "\\uFFFD"]]},
+"output":["ParseError", ["Character", "\\uD800"]]},
 
 {"description": "Invalid Unicode character U+DFFF with valid preceding character",
 "doubleEscaped":true,
 "input": "a\\uDFFF",
-"output":[["Character", "a"], "ParseError", ["Character", "\\uFFFD"]]},
+"output":["ParseError", ["Character", "a\\uDFFF"]]},
 
 {"description": "Invalid Unicode character U+D800 with valid following character",
 "doubleEscaped":true,
 "input": "\\uD800a",
-"output":["ParseError", ["Character", "\\uFFFDa"]]},
+"output":["ParseError", ["Character", "\\uD800a"]]},
 
 {"description":"CR followed by U+0000",
 "input":"\r\u0000",
diff --git a/html/parsing/html5lib/html-tokenizer/xmlViolation.test b/html/parsing/html5lib/html-tokenizer/xmlViolation.test
index 137d964..d108c4c 100644
--- a/html/parsing/html5lib/html-tokenizer/xmlViolation.test
+++ b/html/parsing/html5lib/html-tokenizer/xmlViolation.test
@@ -3,16 +3,16 @@
 {"description":"Non-XML character",
 "input":"a\uFFFFb",
 "ignoreErrorOrder":true,
-"output":["ParseError",["Character","a\uFFFDb"]]},
+"output":["ParseError",["Character","a\uFFFFb"]]},
 
 {"description":"Non-XML space",
 "input":"a\u000Cb",
 "ignoreErrorOrder":true,
-"output":[["Character","a b"]]},
+"output":[["Character","a\u000Cb"]]},
 
 {"description":"Double hyphen in comment",
 "input":"<!-- foo -- bar -->",
-"output":["ParseError",["Comment"," foo - - bar "]]},
+"output":["ParseError",["Comment"," foo -- bar "]]},
 
 {"description":"FF between attributes",
 "input":"<a b=''\u000Cc=''>",
diff --git a/html/parsing/html5lib/html-tree/adoption01.dat b/html/parsing/html5lib/html-tree/adoption01.dat
index 2e1127e..93c5886 100644
--- a/html/parsing/html5lib/html-tree/adoption01.dat
+++ b/html/parsing/html5lib/html-tree/adoption01.dat
@@ -71,14 +71,13 @@
 |   <body>
 |     <a>
 |       "1"
+|       <div>
+|         "2"
 |     <div>
 |       <a>
-|         "2"
-|       <div>
-|         <a>
-|           "3"
-|         "4"
-|       "5"
+|         "3"
+|       "4"
+|     "5"
 
 #data
 <table><a>1<p>2</a>3</p>
@@ -243,13 +242,6 @@
 #errors
 (1,5): expected-doctype-but-got-start-tag
 (1,65): adoption-agency-1.3
-(1,65): adoption-agency-1.3
-(1,65): adoption-agency-1.3
-(1,65): adoption-agency-1.3
-(1,65): adoption-agency-1.3
-(1,65): adoption-agency-1.3
-(1,65): adoption-agency-1.3
-(1,65): adoption-agency-1.3
 (1,65): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -258,25 +250,17 @@
 |     <div>
 |       <a>
 |         <b>
-|       <b>
-|         <div>
-|           <a>
 |           <div>
-|             <a>
 |             <div>
-|               <a>
 |               <div>
-|                 <a>
 |                 <div>
-|                   <a>
 |                   <div>
-|                     <a>
 |                     <div>
-|                       <a>
 |                       <div>
-|                         <a>
+|                         <div>
 |                           <div>
-|                             <div>
+|       <div>
+|         <a>
 
 #data
 <div><a><b><u><i><code><div></a>
diff --git a/html/parsing/html5lib/html-tree/adoption02.dat b/html/parsing/html5lib/html-tree/adoption02.dat
index e54d803..9c7b564 100644
--- a/html/parsing/html5lib/html-tree/adoption02.dat
+++ b/html/parsing/html5lib/html-tree/adoption02.dat
@@ -24,16 +24,14 @@
 (1,3): expected-doctype-but-got-start-tag
 (1,35): unexpected-start-tag-implies-end-tag
 (1,35): adoption-agency-1.3
-(1,35): adoption-agency-1.3
 (1,35): expected-closing-tag-but-got-eof
 #document
 | <html>
 |   <head>
 |   <body>
 |     <a>
-|     <div>
-|       <a>
+|       <div>
 |         <style>
-|       <address>
-|         <a>
-|         <a>
+|     <address>
+|       <a>
+|       <a>
diff --git a/html/parsing/html5lib/html-tree/doctype01.dat b/html/parsing/html5lib/html-tree/doctype01.dat
index cec6638..1027dc6 100644
--- a/html/parsing/html5lib/html-tree/doctype01.dat
+++ b/html/parsing/html5lib/html-tree/doctype01.dat
@@ -303,6 +303,8 @@
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">Hello
 #errors
+#shoulds
+obsolete
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -385,6 +387,8 @@
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">
 #errors
 (1,50): unexpected-char-in-doctype
+#shoulds
+obsolete
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -395,6 +399,8 @@
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"'http://www.w3.org/TR/html4/strict.dtd'>
 #errors
 (1,50): unexpected-char-in-doctype
+#shoulds
+obsolete
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -406,6 +412,8 @@
 #errors
 (1,21): unexpected-char-in-doctype
 (1,49): unexpected-char-in-doctype
+#shoulds
+obsolete
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -417,6 +425,8 @@
 #errors
 (1,21): unexpected-char-in-doctype
 (1,49): unexpected-char-in-doctype
+#shoulds
+obsolete
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
diff --git a/html/parsing/html5lib/html-tree/domjs-unsafe.dat b/html/parsing/html5lib/html-tree/domjs-unsafe.dat
index 34b4e62..0b1b737 100644
Binary files a/html/parsing/html5lib/html-tree/domjs-unsafe.dat and b/html/parsing/html5lib/html-tree/domjs-unsafe.dat differ
diff --git a/html/parsing/html5lib/html-tree/main-element.dat b/html/parsing/html5lib/html-tree/main-element.dat
index 0d2102e..b8c55dc 100644
--- a/html/parsing/html5lib/html-tree/main-element.dat
+++ b/html/parsing/html5lib/html-tree/main-element.dat
@@ -30,6 +30,8 @@
 #data
 <!DOCTYPE html>xxx<svg><x><g><a><main><b>
 #errors
+no </svg main> before <b>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/pending-spec-changes-plain-text-unsafe.dat b/html/parsing/html5lib/html-tree/pending-spec-changes-plain-text-unsafe.dat
index 3ee8cec..f287b31 100644
Binary files a/html/parsing/html5lib/html-tree/pending-spec-changes-plain-text-unsafe.dat and b/html/parsing/html5lib/html-tree/pending-spec-changes-plain-text-unsafe.dat differ
diff --git a/html/parsing/html5lib/html-tree/plain-text-unsafe.dat b/html/parsing/html5lib/html-tree/plain-text-unsafe.dat
index f40dd57..cf72889 100644
Binary files a/html/parsing/html5lib/html-tree/plain-text-unsafe.dat and b/html/parsing/html5lib/html-tree/plain-text-unsafe.dat differ
diff --git a/html/parsing/html5lib/html-tree/tables01.dat b/html/parsing/html5lib/html-tree/tables01.dat
index f0caaa3..39303dd 100644
--- a/html/parsing/html5lib/html-tree/tables01.dat
+++ b/html/parsing/html5lib/html-tree/tables01.dat
@@ -48,8 +48,6 @@
 (1,7): expected-doctype-but-got-start-tag
 (1,24): unexpected-end-tag
 (1,27): foster-parenting-character-in-table
-(1,27): foster-parenting-character-in-table
-(1,27): foster-parenting-character-in-table
 (1,27): eof-in-table
 #document
 | <html>
diff --git a/html/parsing/html5lib/html-tree/template.dat b/html/parsing/html5lib/html-tree/template.dat
index 3ae40c3..81aab6d 100644
--- a/html/parsing/html5lib/html-tree/template.dat
+++ b/html/parsing/html5lib/html-tree/template.dat
@@ -1,6 +1,7 @@
 #data
 <body><template>Hello</template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -12,6 +13,7 @@
 #data
 <template>Hello</template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -23,6 +25,7 @@
 #data
 <template></template><div></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -34,6 +37,7 @@
 #data
 <html><template>Hello</template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -45,6 +49,7 @@
 #data
 <head><template><div></div></template></head>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -56,6 +61,9 @@
 #data
 <div><template><div><span></template><b>
 #errors
+no DOCTYPE
+no </span>
+no </b>
 #document
 | <html>
 |   <head>
@@ -70,6 +78,10 @@
 #data
 <div><template></div>Hello
 #errors
+no DOCTYPE
+stray </div>
+no </template>
+no </div>
 #document
 | <html>
 |   <head>
@@ -82,6 +94,8 @@
 #data
 <div></template></div>
 #errors
+no DOCTYPE
+stray </template>
 #document
 | <html>
 |   <head>
@@ -91,6 +105,7 @@
 #data
 <table><template></template></table>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -102,6 +117,10 @@
 #data
 <table><template></template></div>
 #errors
+no DOCTYPE
+</div> in table
+stray </div>
+no </table>
 #document
 | <html>
 |   <head>
@@ -113,6 +132,10 @@
 #data
 <table><div><template></template></div>
 #errors
+no DOCTYPE
+<div> in table
+</div> in table
+no </table>
 #document
 | <html>
 |   <head>
@@ -125,6 +148,10 @@
 #data
 <table><template></template><div></div>
 #errors
+no DOCTYPE
+<div> in table
+</div> in table
+no </table>
 #document
 | <html>
 |   <head>
@@ -137,6 +164,7 @@
 #data
 <table>   <template></template></table>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -149,6 +177,8 @@
 #data
 <table><tbody><template></template></tbody>
 #errors
+no DOCTYPE
+no </table>
 #document
 | <html>
 |   <head>
@@ -161,6 +191,9 @@
 #data
 <table><tbody><template></tbody></template>
 #errors
+no DOCTYPE
+stray </tbody>
+no </table>
 #document
 | <html>
 |   <head>
@@ -173,6 +206,7 @@
 #data
 <table><tbody><template></template></tbody></table>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -185,6 +219,8 @@
 #data
 <table><thead><template></template></thead>
 #errors
+no DOCTYPE
+no </table>
 #document
 | <html>
 |   <head>
@@ -197,6 +233,8 @@
 #data
 <table><tfoot><template></template></tfoot>
 #errors
+no DOCTYPE
+no </table>
 #document
 | <html>
 |   <head>
@@ -209,6 +247,7 @@
 #data
 <select><template></template></select>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -220,6 +259,7 @@
 #data
 <select><template><option></option></template></select>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -232,6 +272,8 @@
 #data
 <template><option></option></select><option></option></template>
 #errors
+no DOCTYPE
+stray </select>
 #document
 | <html>
 |   <head>
@@ -244,6 +286,7 @@
 #data
 <select><template></template><option></select>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -256,6 +299,7 @@
 #data
 <select><option><template></template></select>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -268,6 +312,9 @@
 #data
 <select><template>
 #errors
+no DOCTYPE
+no </template>
+no </select>
 #document
 | <html>
 |   <head>
@@ -279,6 +326,9 @@
 #data
 <select><option></option><template>
 #errors
+no DOCTYPE
+no </template>
+no </select>
 #document
 | <html>
 |   <head>
@@ -291,6 +341,10 @@
 #data
 <select><option></option><template><option>
 #errors
+no DOCTYPE
+no </option>
+no </template>
+no </select>
 #document
 | <html>
 |   <head>
@@ -304,6 +358,8 @@
 #data
 <table><thead><template><td></template></table>
 #errors
+no DOCTYPE
+no </td> at </template>
 #document
 | <html>
 |   <head>
@@ -317,6 +373,8 @@
 #data
 <table><template><thead></template></table>
 #errors
+no DOCTYPE
+no </thead> at </template>
 #document
 | <html>
 |   <head>
@@ -329,6 +387,9 @@
 #data
 <body><table><template><td></tr><div></template></table>
 #errors
+no DOCTYPE
+stray </tr>
+no </div>
 #document
 | <html>
 |   <head>
@@ -342,6 +403,9 @@
 #data
 <table><template><thead></template></thead></table>
 #errors
+no DOCTYPE
+no </thead> at </template>
+stray </thead>
 #document
 | <html>
 |   <head>
@@ -354,6 +418,8 @@
 #data
 <table><thead><template><tr></template></table>
 #errors
+no DOCTYPE
+no </tr> at </template>
 #document
 | <html>
 |   <head>
@@ -367,6 +433,8 @@
 #data
 <table><template><tr></template></table>
 #errors
+no DOCTYPE
+no </tr>
 #document
 | <html>
 |   <head>
@@ -379,6 +447,10 @@
 #data
 <table><tr><template><td>
 #errors
+no DOCTYPE
+no </template> (in body)
+no </template>
+no </table>
 #document
 | <html>
 |   <head>
@@ -393,6 +465,8 @@
 #data
 <table><template><tr><template><td></template></tr></template></table>
 #errors
+no DOCTYPE
+no </td>
 #document
 | <html>
 |   <head>
@@ -408,6 +482,7 @@
 #data
 <table><template><tr><template><td></td></template></tr></template></table>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -423,6 +498,9 @@
 #data
 <table><template><td></template>
 #errors
+no DOCTYPE
+no </td>
+no </table>
 #document
 | <html>
 |   <head>
@@ -435,6 +513,7 @@
 #data
 <body><template><td></td></template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -446,6 +525,7 @@
 #data
 <body><template><template><tr></tr></template><td></td></template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -460,6 +540,10 @@
 #data
 <table><colgroup><template><col>
 #errors
+no DOCTYPE
+no </template> (in body)
+no </template>
+no </colgroup>
 #document
 | <html>
 |   <head>
@@ -473,6 +557,10 @@
 #data
 <frameset><template><frame></frame></template></frameset>
 #errors
+no DOCTYPE
+<template> in frameset
+stray </frame>
+</template> in frameset
 #document
 | <html>
 |   <head>
@@ -482,6 +570,12 @@
 #data
 <template><frame></frame></frameset><frame></frame></template>
 #errors
+no DOCTYPE
+<frame> in body
+stray </frame>
+stray </frameset>
+<frame> in body
+stray </frame>
 #document
 | <html>
 |   <head>
@@ -492,6 +586,8 @@
 #data
 <template><div><frameset><span></span></div><span></span></template>
 #errors
+no DOCTYPE
+<frameset> in body
 #document
 | <html>
 |   <head>
@@ -505,6 +601,8 @@
 #data
 <body><template><div><frameset><span></span></div><span></span></template></body>
 #errors
+no DOCTYPE
+<frameset> in body
 #document
 | <html>
 |   <head>
@@ -518,6 +616,7 @@
 #data
 <body><template><script>var i = 1;</script><td></td></template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -531,6 +630,9 @@
 #data
 <body><template><tr><div></div></tr></template>
 #errors
+no DOCTYPE
+<div> in table
+</div> in table
 #document
 | <html>
 |   <head>
@@ -543,6 +645,9 @@
 #data
 <body><template><tr></tr><td></td></template>
 #errors
+no DOCTYPE
+no <tr>
+no </tr>
 #document
 | <html>
 |   <head>
@@ -556,6 +661,8 @@
 #data
 <body><template><td></td></tr><td></td></template>
 #errors
+no DOCTYPE
+stray </tr>
 #document
 | <html>
 |   <head>
@@ -568,6 +675,8 @@
 #data
 <body><template><td></td><tbody><td></td></template>
 #errors
+no DOCTYPE
+<tbody> in tr
 #document
 | <html>
 |   <head>
@@ -580,6 +689,9 @@
 #data
 <body><template><td></td><caption></caption><td></td></template>
 #errors
+no DOCTYPE
+<caption> in table body
+stray </caption>
 #document
 | <html>
 |   <head>
@@ -592,6 +704,9 @@
 #data
 <body><template><td></td><colgroup></caption><td></td></template>
 #errors
+no DOCTYPE
+<colgroup> in table body
+stray </caption>
 #document
 | <html>
 |   <head>
@@ -604,6 +719,8 @@
 #data
 <body><template><td></td></table><td></td></template>
 #errors
+no DOCTYPE
+stray </table>
 #document
 | <html>
 |   <head>
@@ -616,6 +733,8 @@
 #data
 <body><template><tr></tr><tbody><tr></tr></template>
 #errors
+no DOCTYPE
+<tbody> in table body
 #document
 | <html>
 |   <head>
@@ -628,6 +747,8 @@
 #data
 <body><template><tr></tr><caption><tr></tr></template>
 #errors
+no DOCTYPE
+<caption> in table body
 #document
 | <html>
 |   <head>
@@ -640,6 +761,8 @@
 #data
 <body><template><tr></tr></table><tr></tr></template>
 #errors
+no DOCTYPE
+stray </table>
 #document
 | <html>
 |   <head>
@@ -652,6 +775,7 @@
 #data
 <body><template><thead></thead><caption></caption><tbody></tbody></template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -665,6 +789,8 @@
 #data
 <body><template><thead></thead></table><tbody></tbody></template></body>
 #errors
+no DOCTYPE
+stray </table>
 #document
 | <html>
 |   <head>
@@ -677,6 +803,9 @@
 #data
 <body><template><div><tr></tr></div></template>
 #errors
+no DOCTYPE
+<tr> in body
+stray </tr>
 #document
 | <html>
 |   <head>
@@ -688,6 +817,7 @@
 #data
 <body><template><em>Hello</em></template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -700,6 +830,7 @@
 #data
 <body><template><!--comment--></template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -711,6 +842,7 @@
 #data
 <body><template><style></style><td></td></template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -723,6 +855,7 @@
 #data
 <body><template><meta><td></td></template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -735,6 +868,7 @@
 #data
 <body><template><link><td></td></template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -747,6 +881,7 @@
 #data
 <body><template><template><tr></tr></template><td></td></template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -761,6 +896,8 @@
 #data
 <body><table><colgroup><template><col></col></template></colgroup></table></body>
 #errors
+no DOCTYPE
+stray </col>
 #document
 | <html>
 |   <head>
@@ -774,6 +911,9 @@
 #data
 <body a=b><template><div></div><body c=d><div></div></body></template></body>
 #errors
+no DOCTYPE
+<body>
+</body>
 #document
 | <html>
 |   <head>
@@ -787,6 +927,9 @@
 #data
 <html a=b><template><div><html b=c><span></template>
 #errors
+no DOCTYPE
+<html>
+no </span>
 #document
 | <html>
 |   a="b"
@@ -800,6 +943,10 @@
 #data
 <html a=b><template><col></col><html b=c><col></col></template>
 #errors
+no DOCTYPE
+stray </col>
+<html>
+</col>
 #document
 | <html>
 |   a="b"
@@ -813,6 +960,12 @@
 #data
 <html a=b><template><frame></frame><html b=c><frame></frame></template>
 #errors
+no DOCTYPE
+<frame> in body
+stray </frame>
+<html> ignored
+<frame> in body
+stray </frame>
 #document
 | <html>
 |   a="b"
@@ -824,6 +977,9 @@
 #data
 <body><template><tr></tr><template></template><td></td></template>
 #errors
+no DOCTYPE
+no <tr>
+no </tr> before </template>
 #document
 | <html>
 |   <head>
@@ -839,6 +995,7 @@
 #data
 <body><template><thead></thead><template><tr></tr></template><tr></tr><tfoot></tfoot></template>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -856,6 +1013,8 @@
 #data
 <body><template><template><b><template></template></template>text</template>
 #errors
+no DOCTYPE
+no </b> at </template>
 #document
 | <html>
 |   <head>
@@ -872,6 +1031,10 @@
 #data
 <body><template><col><colgroup>
 #errors
+no DOCTYPE
+<colgroup>
+no </template> (in body)
+no </template>
 #document
 | <html>
 |   <head>
@@ -883,6 +1046,10 @@
 #data
 <body><template><col></colgroup>
 #errors
+no DOCTYPE
+</colgroup>
+no </template> (in body)
+no </template>
 #document
 | <html>
 |   <head>
@@ -894,6 +1061,8 @@
 #data
 <body><template><col><colgroup></template></body>
 #errors
+no DOCTYPE
+<colgroup>
 #document
 | <html>
 |   <head>
@@ -905,6 +1074,10 @@
 #data
 <body><template><col><div>
 #errors
+no DOCTYPE
+<div> in colgroup
+no </div>
+no </template>
 #document
 | <html>
 |   <head>
@@ -916,6 +1089,10 @@
 #data
 <body><template><col></div>
 #errors
+no DOCTYPE
+stray </div>
+no </template> (in body)
+no </template>
 #document
 | <html>
 |   <head>
@@ -927,6 +1104,10 @@
 #data
 <body><template><col>Hello
 #errors
+no DOCTYPE
+"Hello" in colgroup
+no </template> (in body)
+no </template>
 #document
 | <html>
 |   <head>
@@ -938,6 +1119,10 @@
 #data
 <body><template><i><menu>Foo</i>
 #errors
+no DOCTYPE
+AAA at </i>
+no </menu>
+no </template>
 #document
 | <html>
 |   <head>
@@ -952,6 +1137,12 @@
 #data
 <body><template></div><div>Foo</div><template></template><tr></tr>
 #errors
+no DOCTYPE
+stray </div>
+<tr>
+stray </tr>
+no </template> (in body)
+no </template>
 #document
 | <html>
 |   <head>
@@ -966,6 +1157,9 @@
 #data
 <body><div><template></div><tr><td>Foo</td></tr></template>
 #errors
+no DOCTYPE
+stray </div>
+no </div>
 #document
 | <html>
 |   <head>
@@ -980,6 +1174,10 @@
 #data
 <template></figcaption><sub><table></table>
 #errors
+no DOCTYPE
+stray </figcaption>
+no </sub>
+no </template>
 #document
 | <html>
 |   <head>
@@ -992,6 +1190,9 @@
 #data
 <template><template>
 #errors
+no DOCTYPE
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1004,6 +1205,9 @@
 #data
 <template><div>
 #errors
+no DOCTYPE
+no </div>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1015,6 +1219,10 @@
 #data
 <template><template><div>
 #errors
+no DOCTYPE
+no </div>
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1028,6 +1236,10 @@
 #data
 <template><template><table>
 #errors
+no DOCTYPE
+no </table>
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1041,6 +1253,10 @@
 #data
 <template><template><tbody>
 #errors
+no DOCTYPE
+no </template> (in body)
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1054,6 +1270,10 @@
 #data
 <template><template><tr>
 #errors
+no DOCTYPE
+no </template> (in body)
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1067,6 +1287,10 @@
 #data
 <template><template><td>
 #errors
+no DOCTYPE
+no </template> (in body)
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1080,6 +1304,10 @@
 #data
 <template><template><caption>
 #errors
+no DOCTYPE
+no </caption>
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1093,6 +1321,10 @@
 #data
 <template><template><colgroup>
 #errors
+no DOCTYPE
+no </colgroup>
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1106,6 +1338,10 @@
 #data
 <template><template><col>
 #errors
+no DOCTYPE
+no </template> (in body)
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1119,6 +1355,11 @@
 #data
 <template><template><tbody><select>
 #errors
+no DOCTYPE
+<select> in table
+no </select> at EOF
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1133,6 +1374,11 @@
 #data
 <template><template><table>Foo
 #errors
+no DOCTYPE
+"Foo" in table
+no </table>
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1147,6 +1393,11 @@
 #data
 <template><template><frame>
 #errors
+no DOCTYPE
+<frame> in body
+no </template> (in body)
+no </template>
+no </template>
 #document
 | <html>
 |   <head>
@@ -1159,6 +1410,10 @@
 #data
 <template><template><script>var i
 #errors
+no DOCTYPE
+no </script> at EOF
+no </template> at EOF
+no </template> at EOF
 #document
 | <html>
 |   <head>
@@ -1173,6 +1428,10 @@
 #data
 <template><template><style>var i
 #errors
+no DOCTYPE
+no </style> at EOF
+no </template> at EOF
+no </template> at EOF
 #document
 | <html>
 |   <head>
@@ -1187,6 +1446,9 @@
 #data
 <template><table></template><body><span>Foo
 #errors
+no DOCTYPE
+no </table> at </template>
+no </span> at EOF
 #document
 | <html>
 |   <head>
@@ -1200,6 +1462,9 @@
 #data
 <template><td></template><body><span>Foo
 #errors
+no DOCTYPE
+no </td> at </template>
+no </span> at EOF
 #document
 | <html>
 |   <head>
@@ -1213,6 +1478,9 @@
 #data
 <template><object></template><body><span>Foo
 #errors
+no DOCTYPE
+not closed before ancestor end tag:object at </template>
+no </span> at EOF
 #document
 | <html>
 |   <head>
@@ -1226,6 +1494,9 @@
 #data
 <template><svg><template>
 #errors
+no DOCTYPE
+no end tag at EOF <svg template>
+no end tag at EOF <template>
 #document
 | <html>
 |   <head>
@@ -1238,6 +1509,9 @@
 #data
 <template><svg><foo><template><foreignObject><div></template><div>
 #errors
+no DOCTYPE
+not closed before ancestor end tag:div at </template>
+no end tag before EOF:div
 #document
 | <html>
 |   <head>
@@ -1254,6 +1528,11 @@
 #data
 <dummy><template><span></dummy>
 #errors
+no DOCTYPE
+stray end tag </dummy>
+no </span> at EOF
+no </template> at EOF
+no </dummy> at EOF
 #document
 | <html>
 |   <head>
@@ -1266,6 +1545,7 @@
 #data
 <body><table><tr><td><select><template>Foo</template><caption>A</table>
 #errors
+no DOCTYPE
 (1,62): unexpected-caption-in-select-in-table
 (1,71): unexpected-table-end-in-caption
 #document
@@ -1286,6 +1566,7 @@
 #data
 <body></body><template>
 #errors
+no DOCTYPE
 (1,23): template-after-body
 (1,24): eof-in-template
 #document
@@ -1298,6 +1579,7 @@
 #data
 <head></head><template>
 #errors
+no DOCTYPE
 (1,23): template-after-head
 (1,24): eof-in-template
 #document
@@ -1310,6 +1592,7 @@
 #data
 <head></head><template>Foo</template>
 #errors
+no DOCTYPE
 (1,23): template-after-head
 #document
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests1.dat b/html/parsing/html5lib/html-tree/tests1.dat
index f12e871..c5019ad 100644
--- a/html/parsing/html5lib/html-tree/tests1.dat
+++ b/html/parsing/html5lib/html-tree/tests1.dat
@@ -428,15 +428,6 @@ Line1<br>Line2<br>Line3<br>Line4
 (1,41): unexpected-start-tag-implies-table-voodoo
 (1,48): foster-parenting-character-in-table
 (1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-start-tag-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
-(1,48): foster-parenting-character-in-table
 (1,48): unexpected-cell-in-table-body
 (1,63): unexpected-cell-end-tag
 (1,71): eof-in-table
@@ -711,7 +702,6 @@ Line1<br>Line2<br>Line3<br>Line4
 #errors
 (1,8): expected-doctype-but-got-start-tag
 (1,23): unexpected-end-tag
-(1,27): adoption-agency-1.2
 (1,31): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -722,6 +712,8 @@ Line1<br>Line2<br>Line3<br>Line4
 |       <p>
 |         <b>
 |           id="b"
+|     <b>
+|       id="b"
 |       "TEST"
 
 #data
@@ -839,7 +831,6 @@ Line1<br>Line2<br>Line3<br>Line4
 |       "D"
 
 #data
-
 #errors
 (1,0): expected-doctype-but-got-eof
 #document
@@ -1127,7 +1118,6 @@ Line1<br>Line2<br>Line3<br>Line4
 (1,39): unexpected-end-tag
 (1,45): foster-parenting-character-in-table
 (1,45): foster-parenting-character-in-table
-(1,68): foster-parenting-character-in-table
 (1,71): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -1155,6 +1145,7 @@ Line1<br>Line2<br>Line3<br>Line4
 #errors
 (1,15): expected-doctype-but-got-start-tag
 (1,54): unexpected-cell-end-tag
+"x" in table
 (1,71): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -1178,8 +1169,6 @@ Line1<br>Line2<br>Line3<br>Line4
 (1,7): expected-doctype-but-got-start-tag
 (1,22): unexpected-start-tag-implies-table-voodoo
 (1,29): foster-parenting-character-in-table
-(1,29): foster-parenting-character-in-table
-(1,29): foster-parenting-character-in-table
 (1,54): unexpected-cell-end-tag
 (1,68): foster-parenting-character-in-table
 (1,71): expected-closing-tag-but-got-eof
diff --git a/html/parsing/html5lib/html-tree/tests10.dat b/html/parsing/html5lib/html-tree/tests10.dat
index 87d9478..652b2b1 100644
--- a/html/parsing/html5lib/html-tree/tests10.dat
+++ b/html/parsing/html5lib/html-tree/tests10.dat
@@ -235,10 +235,9 @@
 <!DOCTYPE html><body><table><colgroup><svg><g>foo</g><g>bar</g><p>baz</table><p>quux
 #errors
 (1,43) foster-parenting-start-tag
+<p> in svg
 (1,66) foster-parenting-start-tag
 (1,67) foster-parenting-character
-(1,68) foster-parenting-character
-(1,69) foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests15.dat b/html/parsing/html5lib/html-tree/tests15.dat
index 93d06a8..f9f68c4 100644
--- a/html/parsing/html5lib/html-tree/tests15.dat
+++ b/html/parsing/html5lib/html-tree/tests15.dat
@@ -91,7 +91,6 @@
 <!doctype html><table> X<meta></table>
 #errors
 (1,23): foster-parenting-character
-(1,24): foster-parenting-character
 (1,30): foster-parenting-start-character
 #document
 | <!DOCTYPE html>
@@ -106,7 +105,6 @@
 <!doctype html><table> x</table>
 #errors
 (1,23): foster-parenting-character
-(1,24): foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -119,8 +117,6 @@
 <!doctype html><table> x </table>
 #errors
 (1,23): foster-parenting-character
-(1,24): foster-parenting-character
-(1,25): foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -133,7 +129,6 @@
 <!doctype html><table><tr> x</table>
 #errors
 (1,27): foster-parenting-character
-(1,28): foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -164,8 +159,6 @@
 #errors
 (1,30): foster-parenting-start-tag
 (1,31): foster-parenting-character
-(1,32): foster-parenting-character
-(1,33): foster-parenting-character
 (1,37): foster-parenting-end-tag
 #document
 | <!DOCTYPE html>
diff --git a/html/parsing/html5lib/html-tree/tests16.dat b/html/parsing/html5lib/html-tree/tests16.dat
index c8f6d43..fe0f4f1 100644
--- a/html/parsing/html5lib/html-tree/tests16.dat
+++ b/html/parsing/html5lib/html-tree/tests16.dat
@@ -2323,8 +2323,8 @@
 |     "-->"
 
 #data
-<!doctype html><table>
-
+| <!doctype html><table>
+| 
 #errors
 (2,0): eof-in-table
 #document
diff --git a/html/parsing/html5lib/html-tree/tests18.dat b/html/parsing/html5lib/html-tree/tests18.dat
index 926bccb..c8b080d 100644
--- a/html/parsing/html5lib/html-tree/tests18.dat
+++ b/html/parsing/html5lib/html-tree/tests18.dat
@@ -15,17 +15,6 @@
 #errors
 (1,33): foster-parenting-start-tag
 (1,34): foster-parenting-character
-(1,35): foster-parenting-character
-(1,36): foster-parenting-character
-(1,37): foster-parenting-character
-(1,38): foster-parenting-character
-(1,39): foster-parenting-character
-(1,40): foster-parenting-character
-(1,41): foster-parenting-character
-(1,42): foster-parenting-character
-(1,43): foster-parenting-character
-(1,44): foster-parenting-character
-(1,45): foster-parenting-character
 (1,45): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -41,17 +30,6 @@
 #errors
 (1,40): foster-parenting-start-tag
 (1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
-(1,41): foster-parenting-character
 (1,52): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -68,17 +46,6 @@
 #errors
 (1,44): foster-parenting-start-tag
 (1,45): foster-parenting-character
-(1,46): foster-parenting-character
-(1,47): foster-parenting-character
-(1,48): foster-parenting-character
-(1,49): foster-parenting-character
-(1,50): foster-parenting-character
-(1,51): foster-parenting-character
-(1,52): foster-parenting-character
-(1,53): foster-parenting-character
-(1,54): foster-parenting-character
-(1,55): foster-parenting-character
-(1,56): foster-parenting-character
 (1,56): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -126,8 +93,6 @@
 <!doctype html><table><tr><style></script></style>abc
 #errors
 (1,51): foster-parenting-character
-(1,52): foster-parenting-character
-(1,53): foster-parenting-character
 (1,53): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -145,8 +110,6 @@
 <!doctype html><table><tr><script></style></script>abc
 #errors
 (1,52): foster-parenting-character
-(1,53): foster-parenting-character
-(1,54): foster-parenting-character
 (1,54): eof-in-table
 #document
 | <!DOCTYPE html>
diff --git a/html/parsing/html5lib/html-tree/tests19.dat b/html/parsing/html5lib/html-tree/tests19.dat
index 9e7e03f..b103041 100644
--- a/html/parsing/html5lib/html-tree/tests19.dat
+++ b/html/parsing/html5lib/html-tree/tests19.dat
@@ -331,8 +331,6 @@
 <!doctype html><table>abc<!--foo-->
 #errors
 (1,23): foster-parenting-character
-(1,24): foster-parenting-character
-(1,25): foster-parenting-character
 (1,35): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -360,8 +358,6 @@
 <!doctype html><table> b <!--foo-->
 #errors
 (1,23): foster-parenting-character
-(1,24): foster-parenting-character
-(1,25): foster-parenting-character
 (1,35): eof-in-table
 #document
 | <!DOCTYPE html>
@@ -512,6 +508,7 @@
 #data
 <!doctype html><html c=d><body></html><html a=b>
 #errors
+<html> after </html>
 (1,48): non-html-root
 #document
 | <!DOCTYPE html>
@@ -524,6 +521,7 @@
 #data
 <!doctype html><html c=d><frameset></frameset></html><html a=b>
 #errors
+</html> after html
 (1,63): non-html-root
 #document
 | <!DOCTYPE html>
@@ -557,8 +555,6 @@
 <!doctype html><html><frameset></frameset></html>abc
 #errors
 (1,50): expected-eof-but-got-char
-(1,51): expected-eof-but-got-char
-(1,52): expected-eof-but-got-char
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1265,6 +1261,7 @@
 (1,49): foster-parenting-end-tag
 (1,44): adoption-agency-1.3
 (1,44): adoption-agency-1.3
+"f" in table
 (1,50): eof-in-table
 #document
 | <!DOCTYPE html>
diff --git a/html/parsing/html5lib/html-tree/tests2.dat b/html/parsing/html5lib/html-tree/tests2.dat
index 0ad7708..37c4148 100644
--- a/html/parsing/html5lib/html-tree/tests2.dat
+++ b/html/parsing/html5lib/html-tree/tests2.dat
@@ -65,9 +65,6 @@
 <!DOCTYPE html><frameset>test
 #errors
 (1,29): unexpected-char-in-frameset
-(1,29): unexpected-char-in-frameset
-(1,29): unexpected-char-in-frameset
-(1,29): unexpected-char-in-frameset
 (1,29): eof-in-frameset
 #document
 | <!DOCTYPE html>
@@ -133,9 +130,6 @@
 (1,7): expected-doctype-but-got-start-tag
 (1,18): unexpected-start-tag-implies-table-voodoo
 (1,22): foster-parenting-character-in-table
-(1,22): foster-parenting-character-in-table
-(1,22): foster-parenting-character-in-table
-(1,22): foster-parenting-character-in-table
 (1,22): eof-in-table
 #document
 | <html>
@@ -161,9 +155,6 @@
 <!DOCTYPE html><table><tr>TEST
 #errors
 (1,30): foster-parenting-character-in-table
-(1,30): foster-parenting-character-in-table
-(1,30): foster-parenting-character-in-table
-(1,30): foster-parenting-character-in-table
 (1,30): eof-in-table
 #document
 | <!DOCTYPE html>
diff --git a/html/parsing/html5lib/html-tree/tests22.dat b/html/parsing/html5lib/html-tree/tests22.dat
index 31e6d9e..0760962 100644
--- a/html/parsing/html5lib/html-tree/tests22.dat
+++ b/html/parsing/html5lib/html-tree/tests22.dat
@@ -25,13 +25,6 @@
 #errors
 (1,3): expected-doctype-but-got-start-tag
 (1,91): adoption-agency-1.3
-(1,91): adoption-agency-1.3
-(1,91): adoption-agency-1.3
-(1,91): adoption-agency-1.3
-(1,91): adoption-agency-1.3
-(1,91): adoption-agency-1.3
-(1,91): adoption-agency-1.3
-(1,91): adoption-agency-1.3
 (1,91): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -39,45 +32,30 @@
 |   <body>
 |     <a>
 |       <b>
-|     <b>
-|       <div>
-|         id="1"
-|         <a>
 |         <div>
-|           id="2"
-|           <a>
+|           id="1"
 |           <div>
-|             id="3"
-|             <a>
+|             id="2"
 |             <div>
-|               id="4"
-|               <a>
+|               id="3"
 |               <div>
-|                 id="5"
-|                 <a>
+|                 id="4"
 |                 <div>
-|                   id="6"
-|                   <a>
+|                   id="5"
 |                   <div>
-|                     id="7"
-|                     <a>
+|                     id="6"
 |                     <div>
-|                       id="8"
-|                       <a>
-|                         "A"
+|                       id="7"
+|     <div>
+|       id="8"
+|       <a>
+|         "A"
 
 #data
 <a><b><div id=1><div id=2><div id=3><div id=4><div id=5><div id=6><div id=7><div id=8><div id=9>A</a>
 #errors
 (1,3): expected-doctype-but-got-start-tag
 (1,101): adoption-agency-1.3
-(1,101): adoption-agency-1.3
-(1,101): adoption-agency-1.3
-(1,101): adoption-agency-1.3
-(1,101): adoption-agency-1.3
-(1,101): adoption-agency-1.3
-(1,101): adoption-agency-1.3
-(1,101): adoption-agency-1.3
 (1,101): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -85,47 +63,32 @@
 |   <body>
 |     <a>
 |       <b>
-|     <b>
-|       <div>
-|         id="1"
-|         <a>
 |         <div>
-|           id="2"
-|           <a>
+|           id="1"
 |           <div>
-|             id="3"
-|             <a>
+|             id="2"
 |             <div>
-|               id="4"
-|               <a>
+|               id="3"
 |               <div>
-|                 id="5"
-|                 <a>
+|                 id="4"
 |                 <div>
-|                   id="6"
-|                   <a>
+|                   id="5"
 |                   <div>
-|                     id="7"
-|                     <a>
+|                     id="6"
 |                     <div>
-|                       id="8"
-|                       <a>
-|                         <div>
-|                           id="9"
-|                           "A"
+|                       id="7"
+|                       <div>
+|                         id="8"
+|     <div>
+|       id="9"
+|       <a>
+|         "A"
 
 #data
 <a><b><div id=1><div id=2><div id=3><div id=4><div id=5><div id=6><div id=7><div id=8><div id=9><div id=10>A</a>
 #errors
 (1,3): expected-doctype-but-got-start-tag
 (1,112): adoption-agency-1.3
-(1,112): adoption-agency-1.3
-(1,112): adoption-agency-1.3
-(1,112): adoption-agency-1.3
-(1,112): adoption-agency-1.3
-(1,112): adoption-agency-1.3
-(1,112): adoption-agency-1.3
-(1,112): adoption-agency-1.3
 (1,112): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -133,36 +96,28 @@
 |   <body>
 |     <a>
 |       <b>
-|     <b>
-|       <div>
-|         id="1"
-|         <a>
 |         <div>
-|           id="2"
-|           <a>
+|           id="1"
 |           <div>
-|             id="3"
-|             <a>
+|             id="2"
 |             <div>
-|               id="4"
-|               <a>
+|               id="3"
 |               <div>
-|                 id="5"
-|                 <a>
+|                 id="4"
 |                 <div>
-|                   id="6"
-|                   <a>
+|                   id="5"
 |                   <div>
-|                     id="7"
-|                     <a>
+|                     id="6"
 |                     <div>
-|                       id="8"
-|                       <a>
+|                       id="7"
+|                       <div>
+|                         id="8"
 |                         <div>
 |                           id="9"
-|                           <div>
-|                             id="10"
-|                             "A"
+|     <div>
+|       id="10"
+|       <a>
+|         "A"
 
 #data
 <cite><b><cite><i><cite><i><cite><i><div>X</b>TEST
diff --git a/html/parsing/html5lib/html-tree/tests25.dat b/html/parsing/html5lib/html-tree/tests25.dat
index cbc0051..1986f9d 100644
--- a/html/parsing/html5lib/html-tree/tests25.dat
+++ b/html/parsing/html5lib/html-tree/tests25.dat
@@ -79,6 +79,7 @@
 #data
 <!DOCTYPE html><body><command>A
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests26.dat b/html/parsing/html5lib/html-tree/tests26.dat
index 8964624..b9e82d1 100644
--- a/html/parsing/html5lib/html-tree/tests26.dat
+++ b/html/parsing/html5lib/html-tree/tests26.dat
@@ -261,8 +261,8 @@
 |         "2"
 
 #data
-<p><code x</code></p>
-
+| <p><code x</code></p>
+| 
 #errors
 (1,3): expected-doctype-but-got-start-tag
 (1,11): invalid-character-in-attribute-name
diff --git a/html/parsing/html5lib/html-tree/tests3.dat b/html/parsing/html5lib/html-tree/tests3.dat
index 423e2b3..c7583d9 100644
--- a/html/parsing/html5lib/html-tree/tests3.dat
+++ b/html/parsing/html5lib/html-tree/tests3.dat
@@ -285,7 +285,6 @@ foo"
 #data
 <!doctype html><html><body><p><table></table></body></html>
 #errors
-Not known
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests6.dat b/html/parsing/html5lib/html-tree/tests6.dat
index fedc64e..a0f6d57 100644
--- a/html/parsing/html5lib/html-tree/tests6.dat
+++ b/html/parsing/html5lib/html-tree/tests6.dat
@@ -87,8 +87,6 @@ foo
 #errors
 (1,10): expected-doctype-but-got-start-tag
 (2,1): unexpected-char-after-frameset
-(2,2): unexpected-char-after-frameset
-(2,3): unexpected-char-after-frameset
 #document
 | <html>
 |   <head>
@@ -337,8 +335,6 @@ td
 #errors
 (1,7): expected-doctype-but-got-start-tag
 (1,18): foster-parenting-character-in-table
-(1,19): foster-parenting-character-in-table
-(1,20): foster-parenting-character-in-table
 (1,20): eof-in-table
 #document
 | <html>
@@ -352,8 +348,6 @@ td
 foo<col>
 #errors
 (1,1): unexpected-character-in-colgroup
-(1,2): unexpected-character-in-colgroup
-(1,3): unexpected-character-in-colgroup
 #document-fragment
 colgroup
 #document
@@ -602,6 +596,7 @@ html
 #data
 <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html></html>
 #errors
+#shoulds
 (1,50): unknown-doctype element.
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "">
diff --git a/html/parsing/html5lib/html-tree/tests7.dat b/html/parsing/html5lib/html-tree/tests7.dat
index f9471b9..37df9a8 100644
--- a/html/parsing/html5lib/html-tree/tests7.dat
+++ b/html/parsing/html5lib/html-tree/tests7.dat
@@ -62,6 +62,7 @@
 <!doctype html><table>X<tr><td><table> <meta></table></table>
 #errors
 (1,45): unexpected-start-tag-implies-table-voodoo
+meta in table
 #document
 | <!DOCTYPE html>
 | <html>
@@ -335,8 +336,6 @@ html
 (1,7): expected-doctype-but-got-start-tag
 (1,10): foster-parenting-start-tag
 (1,32): foster-parenting-character
-(1,33): foster-parenting-character
-(1,34): foster-parenting-character
 (1,45): expected-closing-tag-but-got-eof
 #document
 | <html>
@@ -358,9 +357,7 @@ A<table><tr> B</tr> B</table>
 #errors
 (1,1): expected-doctype-but-got-chars
 (1,13): foster-parenting-character
-(1,14): foster-parenting-character
 (1,20): foster-parenting-character
-(1,21): foster-parenting-character
 #document
 | <html>
 |   <head>
@@ -375,7 +372,6 @@ A<table><tr> B</tr> </em>C</table>
 #errors
 (1,1): expected-doctype-but-got-chars
 (1,13): foster-parenting-character
-(1,14): foster-parenting-character
 (1,20): foster-parenting-character
 (1,25): unexpected-end-tag
 (1,26): foster-parenting-character
diff --git a/html/parsing/html5lib/html-tree/tests8.dat b/html/parsing/html5lib/html-tree/tests8.dat
index 93289f3..e520673 100644
--- a/html/parsing/html5lib/html-tree/tests8.dat
+++ b/html/parsing/html5lib/html-tree/tests8.dat
@@ -92,6 +92,7 @@ x<table>x
 #errors
 (1,1): expected-doctype-but-got-chars
 (1,9): foster-parenting-character
+EOF
 #document
 | <html>
 |   <head>
@@ -105,6 +106,7 @@ x<table><table>x
 (1,1): expected-doctype-but-got-chars
 (1,15): unexpected-start-tag-implies-end-tag
 (1,16): foster-parenting-character
+EOF
 #document
 | <html>
 |   <head>
@@ -136,14 +138,11 @@ x<table><table>x
 #errors
 (1,3): expected-doctype-but-got-start-tag
 (1,15): adoption-agency-1.3
-(1,15): adoption-agency-1.3
-(1,15): expected-closing-tag-but-got-eof
 #document
 | <html>
 |   <head>
 |   <body>
 |     <a>
-|     <div>
+|       <div>
+|     <p>
 |       <a>
-|       <p>
-|         <a>
diff --git a/html/parsing/html5lib/html-tree/tests9.dat b/html/parsing/html5lib/html-tree/tests9.dat
index 40651a0..61f5386 100644
--- a/html/parsing/html5lib/html-tree/tests9.dat
+++ b/html/parsing/html5lib/html-tree/tests9.dat
@@ -87,8 +87,6 @@
 #errors
 (1,34) foster-parenting-start-token
 (1,39) foster-parenting-character
-(1,40) foster-parenting-character
-(1,41) foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -104,11 +102,7 @@
 #errors
 (1,34) foster-parenting-start-tag
 (1,39) foster-parenting-character
-(1,40) foster-parenting-character
-(1,41) foster-parenting-character
 (1,51) foster-parenting-character
-(1,52) foster-parenting-character
-(1,53) foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -126,11 +120,7 @@
 #errors
 (1,41) foster-parenting-start-tag
 (1,46) foster-parenting-character
-(1,47) foster-parenting-character
-(1,48) foster-parenting-character
 (1,58) foster-parenting-character
-(1,59) foster-parenting-character
-(1,60) foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -149,11 +139,7 @@
 #errors
 (1,45) foster-parenting-start-tag
 (1,50) foster-parenting-character
-(1,51) foster-parenting-character
-(1,52) foster-parenting-character
 (1,62) foster-parenting-character
-(1,63) foster-parenting-character
-(1,64) foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
@@ -272,16 +258,10 @@
 #errors
 (1,44) foster-parenting-start-tag
 (1,49) foster-parenting-character
-(1,50) foster-parenting-character
-(1,51) foster-parenting-character
 (1,61) foster-parenting-character
-(1,62) foster-parenting-character
-(1,63) foster-parenting-character
 (1,71) unexpected-html-element-in-foreign-content
 (1,71) foster-parenting-start-tag
 (1,63) foster-parenting-character
-(1,63) foster-parenting-character
-(1,63) foster-parenting-character
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tricky01.dat b/html/parsing/html5lib/html-tree/tricky01.dat
index f706521..1551037 100644
--- a/html/parsing/html5lib/html-tree/tricky01.dat
+++ b/html/parsing/html5lib/html-tree/tricky01.dat
@@ -209,30 +209,6 @@ Also not bold."
 (1,20): unexpected-start-tag-implies-table-voodoo
 (1,20): closing-non-current-p-element
 (1,21): foster-parenting-character
-(1,22): foster-parenting-character
-(1,23): foster-parenting-character
-(1,24): foster-parenting-character
-(1,25): foster-parenting-character
-(1,26): foster-parenting-character
-(1,27): foster-parenting-character
-(1,28): foster-parenting-character
-(1,29): foster-parenting-character
-(1,30): foster-parenting-character
-(1,31): foster-parenting-character
-(1,32): foster-parenting-character
-(1,33): foster-parenting-character
-(1,34): foster-parenting-character
-(1,35): foster-parenting-character
-(1,36): foster-parenting-character
-(1,37): foster-parenting-character
-(1,38): foster-parenting-character
-(1,39): foster-parenting-character
-(1,40): foster-parenting-character
-(1,41): foster-parenting-character
-(1,42): foster-parenting-character
-(1,43): foster-parenting-character
-(1,44): foster-parenting-character
-(1,45): foster-parenting-character
 (1,45): eof-in-table
 #document
 | <html>
@@ -261,7 +237,9 @@ This page contains an insanely badly-nested tag sequence.
 (3,8): unexpected-start-tag-implies-table-voodoo
 (3,16): unexpected-start-tag-implies-table-voodoo
 (4,6): unexpected-start-tag-implies-table-voodoo
+newline in table
 (5,7): unexpected-start-tag-implies-end-tag
+</p>
 (7,10): adoption-agency-1.3
 (7,20): adoption-agency-1.3
 (8,57): expected-closing-tag-but-got-eof
