diff --git a/html/parsing/html5lib/html-tokenizer/domjs.test b/html/parsing/html5lib/html-tokenizer/domjs.test
index 07a611e..786f96a 100644
--- a/html/parsing/html5lib/html-tokenizer/domjs.test
+++ b/html/parsing/html5lib/html-tokenizer/domjs.test
@@ -20,7 +20,7 @@
         {
             "description":"skip first BOM but not later ones",
             "input":"\uFEFFfoo\uFEFFbar",
-            "output":[["Character", "foo\uFEFFbar"]]
+            "output":[["Character", "\uFEFFfoo\uFEFFbar"]]
         },
         {
             "description":"Non BMP-charref in in RCDATA",
@@ -77,8 +77,8 @@
         {
             "description":"--!NUL in comment ",
             "doubleEscaped":true,
-            "input":"<!----!\\u0000-->",
-            "output":["ParseError", ["Comment", "--!\\uFFFD"]]
+            "input":"<!----!\u0000-->",
+            "output":["ParseError", "ParseError", ["Comment", "--!\uFFFD"]]
         },
         {
             "description":"space EOF after doctype ",
diff --git a/html/parsing/html5lib/html-tokenizer/unicodeCharsProblematic.test b/html/parsing/html5lib/html-tokenizer/unicodeCharsProblematic.test
index cf2fbe6..75b6d92 100644
--- a/html/parsing/html5lib/html-tokenizer/unicodeCharsProblematic.test
+++ b/html/parsing/html5lib/html-tokenizer/unicodeCharsProblematic.test
@@ -1,23 +1,23 @@
 {"tests" : [
 {"description": "Invalid Unicode character U+DFFF",
 "doubleEscaped":true,
-"input": "\\uDFFF",
-"output":["ParseError", ["Character", "\\uFFFD"]]},
+"input": "\uDFFF",
+"output":["ParseError", ["Character", "\uDFFF"]]},
 
 {"description": "Invalid Unicode character U+D800",
 "doubleEscaped":true,
-"input": "\\uD800",
-"output":["ParseError", ["Character", "\\uFFFD"]]},
+"input": "\uD800",
+"output":["ParseError", ["Character", "\uD800"]]},
 
 {"description": "Invalid Unicode character U+DFFF with valid preceding character",
 "doubleEscaped":true,
-"input": "a\\uDFFF",
-"output":["ParseError", ["Character", "a\\uFFFD"]]},
+"input": "a\uDFFF",
+"output":["ParseError", ["Character", "a\uDFFF"]]},
 
 {"description": "Invalid Unicode character U+D800 with valid following character",
 "doubleEscaped":true,
-"input": "\\uD800a",
-"output":["ParseError", ["Character", "\\uFFFDa"]]},
+"input": "\uD800a",
+"output":["ParseError", ["Character", "\uD800a"]]},
 
 {"description":"CR followed by U+0000",
 "input":"\r\u0000",
diff --git a/html/parsing/html5lib/html-tokenizer/xmlViolation.test b/html/parsing/html5lib/html-tokenizer/xmlViolation.test
index ad966be..d108c4c 100644
--- a/html/parsing/html5lib/html-tokenizer/xmlViolation.test
+++ b/html/parsing/html5lib/html-tokenizer/xmlViolation.test
@@ -8,7 +8,7 @@
 {"description":"Non-XML space",
 "input":"a\u000Cb",
 "ignoreErrorOrder":true,
-"output":[["Character","a b"]]},
+"output":[["Character","a\u000Cb"]]},
 
 {"description":"Double hyphen in comment",
 "input":"<!-- foo -- bar -->",
diff --git a/html/parsing/html5lib/html-tree/adoption01.dat b/html/parsing/html5lib/html-tree/adoption01.dat
index 787e1b0..c40b536 100644
--- a/html/parsing/html5lib/html-tree/adoption01.dat
+++ b/html/parsing/html5lib/html-tree/adoption01.dat
@@ -1,6 +1,8 @@
 #data
 <a><p></a></p>
 #errors
+1
+2
 #document
 | <html>
 |   <head>
@@ -12,6 +14,8 @@
 #data
 <a>1<p>2</a>3</p>
 #errors
+1
+2
 #document
 | <html>
 |   <head>
@@ -26,6 +30,8 @@
 #data
 <a>1<button>2</a>3</button>
 #errors
+1
+2
 #document
 | <html>
 |   <head>
@@ -40,6 +46,8 @@
 #data
 <a>1<b>2</a>3</b>
 #errors
+1
+2
 #document
 | <html>
 |   <head>
@@ -54,6 +62,9 @@
 #data
 <a>1<div>2<div>3</a>4</div>5</div>
 #errors
+1
+2
+3
 #document
 | <html>
 |   <head>
@@ -72,6 +83,16 @@
 #data
 <table><a>1<p>2</a>3</p>
 #errors
+1
+2
+3
+4
+5
+6
+7
+8
+9
+10
 #document
 | <html>
 |   <head>
@@ -87,6 +108,9 @@
 #data
 <b><b><a><p></a>
 #errors
+1
+2
+3
 #document
 | <html>
 |   <head>
@@ -100,6 +124,9 @@
 #data
 <b><a><b><p></a>
 #errors
+1
+2
+3
 #document
 | <html>
 |   <head>
@@ -114,6 +141,9 @@
 #data
 <a><b><b><p></a>
 #errors
+1
+2
+3
 #document
 | <html>
 |   <head>
@@ -129,6 +159,9 @@
 #data
 <p>1<s id="A">2<b id="B">3</p>4</s>5</b>
 #errors
+1
+2
+3
 #document
 | <html>
 |   <head>
@@ -153,6 +186,11 @@
 #data
 <table><a>1<td>2</td>3</table>
 #errors
+1
+2
+3
+4
+5
 #document
 | <html>
 |   <head>
@@ -170,6 +208,10 @@
 #data
 <table>A<td>B</td>C</table>
 #errors
+1
+2
+3
+4
 #document
 | <html>
 |   <head>
@@ -184,6 +226,9 @@
 #data
 <a><svg><tr><input></a>
 #errors
+1
+2
+3
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/adoption02.dat b/html/parsing/html5lib/html-tree/adoption02.dat
index d18151b..9c6281c 100644
--- a/html/parsing/html5lib/html-tree/adoption02.dat
+++ b/html/parsing/html5lib/html-tree/adoption02.dat
@@ -1,6 +1,9 @@
 #data
 <b>1<i>2<p>3</b>4
 #errors
+1
+2
+3
 #document
 | <html>
 |   <head>
@@ -18,6 +21,11 @@
 #data
 <a><div><style></style><address><a>
 #errors
+1
+2
+3
+4
+5
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/comments01.dat b/html/parsing/html5lib/html-tree/comments01.dat
index 44f1876..a4fdc68 100644
--- a/html/parsing/html5lib/html-tree/comments01.dat
+++ b/html/parsing/html5lib/html-tree/comments01.dat
@@ -1,6 +1,7 @@
 #data
 FOO<!-- BAR -->BAZ
 #errors
+no doctype
 #document
 | <html>
 |   <head>
@@ -12,6 +13,8 @@ FOO<!-- BAR -->BAZ
 #data
 FOO<!-- BAR --!>BAZ
 #errors
+no doctype
+bad comment
 #document
 | <html>
 |   <head>
@@ -23,6 +26,9 @@ FOO<!-- BAR --!>BAZ
 #data
 FOO<!-- BAR --   >BAZ
 #errors
+no doctype
+bad comment
+EOF
 #document
 | <html>
 |   <head>
@@ -33,6 +39,9 @@ FOO<!-- BAR --   >BAZ
 #data
 FOO<!-- BAR -- <QUX> -- MUX -->BAZ
 #errors
+no doctype
+bad comment
+bad comment
 #document
 | <html>
 |   <head>
@@ -44,6 +53,10 @@ FOO<!-- BAR -- <QUX> -- MUX -->BAZ
 #data
 FOO<!-- BAR -- <QUX> -- MUX --!>BAZ
 #errors
+no doctype
+bad comment
+bad comment
+bad comment
 #document
 | <html>
 |   <head>
@@ -55,6 +68,11 @@ FOO<!-- BAR -- <QUX> -- MUX --!>BAZ
 #data
 FOO<!-- BAR -- <QUX> -- MUX -- >BAZ
 #errors
+no doctype
+bad
+bad
+bad
+bad
 #document
 | <html>
 |   <head>
@@ -65,6 +83,7 @@ FOO<!-- BAR -- <QUX> -- MUX -- >BAZ
 #data
 FOO<!---->BAZ
 #errors
+no doctype
 #document
 | <html>
 |   <head>
@@ -76,6 +95,8 @@ FOO<!---->BAZ
 #data
 FOO<!--->BAZ
 #errors
+no doctype
+bad
 #document
 | <html>
 |   <head>
@@ -87,6 +108,8 @@ FOO<!--->BAZ
 #data
 FOO<!-->BAZ
 #errors
+no doctype
+bad
 #document
 | <html>
 |   <head>
@@ -98,6 +121,8 @@ FOO<!-->BAZ
 #data
 <?xml version="1.0">Hi
 #errors
+no doctype
+bogus comment
 #document
 | <!-- ?xml version="1.0" -->
 | <html>
@@ -108,6 +133,8 @@ FOO<!-->BAZ
 #data
 <?xml version="1.0">
 #errors
+no doctype
+bogus comment
 #document
 | <!-- ?xml version="1.0" -->
 | <html>
@@ -117,6 +144,8 @@ FOO<!-->BAZ
 #data
 <?xml version
 #errors
+no doctype
+bogus comment
 #document
 | <!-- ?xml version -->
 | <html>
@@ -126,6 +155,8 @@ FOO<!-->BAZ
 #data
 FOO<!----->BAZ
 #errors
+no doctype
+bad comment
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/doctype01.dat b/html/parsing/html5lib/html-tree/doctype01.dat
index ae45732..27355c1 100644
--- a/html/parsing/html5lib/html-tree/doctype01.dat
+++ b/html/parsing/html5lib/html-tree/doctype01.dat
@@ -21,6 +21,7 @@
 #data
 <!DOCTYPEhtml>Hello
 #errors
+bogus doctype
 #document
 | <!DOCTYPE html>
 | <html>
@@ -31,6 +32,9 @@
 #data
 <!DOCTYPE>Hello
 #errors
+no space
+no name
+obs doctype
 #document
 | <!DOCTYPE >
 | <html>
@@ -41,6 +45,8 @@
 #data
 <!DOCTYPE >Hello
 #errors
+no name
+obs doctype
 #document
 | <!DOCTYPE >
 | <html>
@@ -51,6 +57,7 @@
 #data
 <!DOCTYPE potato>Hello
 #errors
+obs doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -61,6 +68,7 @@
 #data
 <!DOCTYPE potato >Hello
 #errors
+obs doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -71,6 +79,8 @@
 #data
 <!DOCTYPE potato taco>Hello
 #errors
+obs doctype
+bogus doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -81,6 +91,8 @@
 #data
 <!DOCTYPE potato taco "ddd>Hello
 #errors
+obs doctype
+bogus doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -91,6 +103,8 @@
 #data
 <!DOCTYPE potato sYstEM>Hello
 #errors
+obs doctype
+bogus doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -101,6 +115,8 @@
 #data
 <!DOCTYPE potato sYstEM    >Hello
 #errors
+obs doctype
+bogus doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -111,6 +127,8 @@
 #data
 <!DOCTYPE   potato       sYstEM  ggg>Hello
 #errors
+obs doctype
+bogus doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -121,6 +139,8 @@
 #data
 <!DOCTYPE potato SYSTEM taco  >Hello
 #errors
+obs doctype
+bogus doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -131,6 +151,7 @@
 #data
 <!DOCTYPE potato SYSTEM 'taco"'>Hello
 #errors
+obs doctype
 #document
 | <!DOCTYPE potato "" "taco"">
 | <html>
@@ -141,6 +162,7 @@
 #data
 <!DOCTYPE potato SYSTEM "taco">Hello
 #errors
+obs doctype
 #document
 | <!DOCTYPE potato "" "taco">
 | <html>
@@ -151,6 +173,7 @@
 #data
 <!DOCTYPE potato SYSTEM "tai'co">Hello
 #errors
+obs doctype
 #document
 | <!DOCTYPE potato "" "tai'co">
 | <html>
@@ -161,6 +184,8 @@
 #data
 <!DOCTYPE potato SYSTEMtaco "ddd">Hello
 #errors
+bogus doctype
+obs doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -171,6 +196,8 @@
 #data
 <!DOCTYPE potato grass SYSTEM taco>Hello
 #errors
+bogus doctype
+obs doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -181,6 +208,8 @@
 #data
 <!DOCTYPE potato pUbLIc>Hello
 #errors
+bogus doctype
+obs doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -191,6 +220,8 @@
 #data
 <!DOCTYPE potato pUbLIc >Hello
 #errors
+bogus doctype
+obs doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -201,6 +232,8 @@
 #data
 <!DOCTYPE potato pUbLIcgoof>Hello
 #errors
+bogus doctype
+obs doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -211,6 +244,8 @@
 #data
 <!DOCTYPE potato PUBLIC goof>Hello
 #errors
+bogus doctype
+obs doctype
 #document
 | <!DOCTYPE potato>
 | <html>
@@ -221,6 +256,7 @@
 #data
 <!DOCTYPE potato PUBLIC "go'of">Hello
 #errors
+obs doctype
 #document
 | <!DOCTYPE potato "go'of" "">
 | <html>
@@ -231,6 +267,8 @@
 #data
 <!DOCTYPE potato PUBLIC 'go'of'>Hello
 #errors
+bogus doctype
+obs doctype
 #document
 | <!DOCTYPE potato "go" "">
 | <html>
@@ -241,6 +279,7 @@
 #data
 <!DOCTYPE potato PUBLIC 'go:hh   of' >Hello
 #errors
+obs doctype
 #document
 | <!DOCTYPE potato "go:hh   of" "">
 | <html>
@@ -251,6 +290,8 @@
 #data
 <!DOCTYPE potato PUBLIC "W3C-//dfdf" SYSTEM ggg>Hello
 #errors
+bogus doctype
+obs doctype
 #document
 | <!DOCTYPE potato "W3C-//dfdf" "">
 | <html>
@@ -262,6 +303,8 @@
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">Hello
 #errors
+#should
+doctype
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -272,6 +315,7 @@
 #data
 <!DOCTYPE ...>Hello
 #errors
+bogus doctype
 #document
 | <!DOCTYPE ...>
 | <html>
@@ -283,6 +327,8 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 #errors
+doctype
+#should
 #document
 | <!DOCTYPE html "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 | <html>
@@ -293,6 +339,7 @@
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
 #errors
+doctype
 #document
 | <!DOCTYPE html "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
 | <html>
@@ -304,6 +351,8 @@
 <!-- internal declarations -->
 ]>
 #errors
+bogus
+doctype
 #document
 | <!DOCTYPE root-element>
 | <html>
@@ -316,6 +365,7 @@
   "-//WAPFORUM//DTD XHTML Mobile 1.0//EN"
     "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
 #errors
+doctype
 #document
 | <!DOCTYPE html "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
 | <html>
@@ -325,6 +375,7 @@
 #data
 <!DOCTYPE HTML SYSTEM "http://www.w3.org/DTD/HTML4-strict.dtd"><body><b>Mine!</b></body>
 #errors
+doctype
 #document
 | <!DOCTYPE html "" "http://www.w3.org/DTD/HTML4-strict.dtd">
 | <html>
@@ -336,6 +387,9 @@
 #data
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">
 #errors
+space
+#should
+doctype
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -345,6 +399,9 @@
 #data
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"'http://www.w3.org/TR/html4/strict.dtd'>
 #errors
+space
+#should
+doctype
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -354,6 +411,10 @@
 #data
 <!DOCTYPE HTML PUBLIC"-//W3C//DTD HTML 4.01//EN"'http://www.w3.org/TR/html4/strict.dtd'>
 #errors
+space
+space
+#should
+doctype
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
@@ -363,6 +424,10 @@
 #data
 <!DOCTYPE HTML PUBLIC'-//W3C//DTD HTML 4.01//EN''http://www.w3.org/TR/html4/strict.dtd'>
 #errors
+space
+space
+#should
+doctype
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
 | <html>
diff --git a/html/parsing/html5lib/html-tree/domjs-unsafe.dat b/html/parsing/html5lib/html-tree/domjs-unsafe.dat
index 905b94e..371b669 100644
Binary files a/html/parsing/html5lib/html-tree/domjs-unsafe.dat and b/html/parsing/html5lib/html-tree/domjs-unsafe.dat differ
diff --git a/html/parsing/html5lib/html-tree/entities02.dat b/html/parsing/html5lib/html-tree/entities02.dat
index e2fb42a..c027415 100644
--- a/html/parsing/html5lib/html-tree/entities02.dat
+++ b/html/parsing/html5lib/html-tree/entities02.dat
@@ -1,6 +1,7 @@
 #data
 <div bar="ZZ&gt;YY"></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -11,6 +12,7 @@
 #data
 <div bar="ZZ&"></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -21,6 +23,7 @@
 #data
 <div bar='ZZ&'></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -31,6 +34,7 @@
 #data
 <div bar=ZZ&></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -41,6 +45,8 @@
 #data
 <div bar="ZZ&gt=YY"></div>
 #errors
+no DOCTYPE
+&gt=
 #document
 | <html>
 |   <head>
@@ -51,6 +57,7 @@
 #data
 <div bar="ZZ&gt0YY"></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -61,6 +68,7 @@
 #data
 <div bar="ZZ&gt9YY"></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -71,6 +79,7 @@
 #data
 <div bar="ZZ&gtaYY"></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -81,6 +90,7 @@
 #data
 <div bar="ZZ&gtZYY"></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -91,6 +101,8 @@
 #data
 <div bar="ZZ&gt YY"></div>
 #errors
+no DOCTYPE
+no refc
 #document
 | <html>
 |   <head>
@@ -101,6 +113,8 @@
 #data
 <div bar="ZZ&gt"></div>
 #errors
+no DOCTYPE
+no refc
 #document
 | <html>
 |   <head>
@@ -111,6 +125,8 @@
 #data
 <div bar='ZZ&gt'></div>
 #errors
+no DOCTYPE
+no refc
 #document
 | <html>
 |   <head>
@@ -121,6 +137,8 @@
 #data
 <div bar=ZZ&gt></div>
 #errors
+no DOCTYPE
+no refc
 #document
 | <html>
 |   <head>
@@ -131,6 +149,8 @@
 #data
 <div bar="ZZ&pound_id=23"></div>
 #errors
+no DOCTYPE
+no refc
 #document
 | <html>
 |   <head>
@@ -141,6 +161,7 @@
 #data
 <div bar="ZZ&prod_id=23"></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -151,6 +172,7 @@
 #data
 <div bar="ZZ&pound;_id=23"></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -161,6 +183,7 @@
 #data
 <div bar="ZZ&prod;_id=23"></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -171,6 +194,8 @@
 #data
 <div bar="ZZ&pound=23"></div>
 #errors
+no DOCTYPE
+&pound=
 #document
 | <html>
 |   <head>
@@ -181,6 +206,7 @@
 #data
 <div bar="ZZ&prod=23"></div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -191,6 +217,8 @@
 #data
 <div>ZZ&pound_id=23</div>
 #errors
+no DOCTYPE
+no refc
 #document
 | <html>
 |   <head>
@@ -201,6 +229,7 @@
 #data
 <div>ZZ&prod_id=23</div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -211,6 +240,7 @@
 #data
 <div>ZZ&pound;_id=23</div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -221,6 +251,7 @@
 #data
 <div>ZZ&prod;_id=23</div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
@@ -231,6 +262,8 @@
 #data
 <div>ZZ&pound=23</div>
 #errors
+no DOCTYPE
+&pound=
 #document
 | <html>
 |   <head>
@@ -241,6 +274,7 @@
 #data
 <div>ZZ&prod=23</div>
 #errors
+no DOCTYPE
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tests1.dat b/html/parsing/html5lib/html-tree/tests1.dat
index cbf8bdd..7bfc9e7 100644
--- a/html/parsing/html5lib/html-tree/tests1.dat
+++ b/html/parsing/html5lib/html-tree/tests1.dat
@@ -113,8 +113,6 @@ Line: 1 Col: 6 Unexpected start tag (html). Expected DOCTYPE.
 <html><head></body></html>
 #errors
 Line: 1 Col: 6 Unexpected start tag (html). Expected DOCTYPE.
-Line: 1 Col: 19 Unexpected end tag (body).
-Line: 1 Col: 26 Unexpected end tag (html).
 #document
 | <html>
 |   <head>
@@ -151,7 +149,6 @@ Line: 1 Col: 6 Unexpected start tag (body). Expected DOCTYPE.
 <head></html>
 #errors
 Line: 1 Col: 6 Unexpected start tag (head). Expected DOCTYPE.
-Line: 1 Col: 13 Unexpected end tag (html). Ignored.
 #document
 | <html>
 |   <head>
@@ -170,7 +167,6 @@ Line: 1 Col: 7 Unexpected end tag (head). Expected DOCTYPE.
 </body>
 #errors
 Line: 1 Col: 7 Unexpected end tag (body). Expected DOCTYPE.
-Line: 1 Col: 7 Unexpected end tag (body) after the (implied) root element.
 #document
 | <html>
 |   <head>
@@ -180,7 +176,6 @@ Line: 1 Col: 7 Unexpected end tag (body) after the (implied) root element.
 </html>
 #errors
 Line: 1 Col: 7 Unexpected end tag (html). Expected DOCTYPE.
-Line: 1 Col: 7 Unexpected end tag (html) after the (implied) root element.
 #document
 | <html>
 |   <head>
@@ -263,6 +258,7 @@ Line: 1 Col: 24 End tag (a) violates step 1, paragraph 1 of the adoption agency
 #errors
 Line: 1 Col: 3 Unexpected start tag (b). Expected DOCTYPE.
 Line: 1 Col: 15 End tag (b) violates step 1, paragraph 1 of the adoption agency algorithm.
+EOF in button
 #document
 | <html>
 |   <head>
@@ -277,6 +273,7 @@ Line: 1 Col: 15 End tag (b) violates step 1, paragraph 1 of the adoption agency
 <!DOCTYPE html><span><button>foo</span>bar
 #errors
 39: End tag “span” seen but there were unclosed elements.
+EOF in button
 #document
 | <!DOCTYPE html>
 | <html>
@@ -456,7 +453,6 @@ Line: 1 Col: 71 Unexpected end of file. Expected table content.
 #data
 <!DOCTYPE html><li>hello<li>world<ul>how<li>do</ul>you</body><!--do-->
 #errors
-Line: 1 Col: 61 Unexpected end tag (li). Missing end tag (body).
 #document
 | <!DOCTYPE html>
 | <html>
@@ -660,6 +656,7 @@ Line: 1 Col: 26 Unexpected end of file. Expected end tag (style).
 #data
 <!DOCTYPE html><script> <!-- </script> --> </script> EOF
 #errors
+unmatched </script>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -834,7 +831,6 @@ Line: 1 Col: 22 Expected closing tag. Unexpected end of file.
 |       "D"
 
 #data
-
 #errors
 Line: 1 Col: 0 Unexpected End of file. Expected DOCTYPE.
 #document
@@ -1123,7 +1119,6 @@ Line: 1 Col: 39 End tag (a) violates step 1, paragraph 1 of the adoption agency
 Line: 1 Col: 45 Unexpected implied end tag (a) in the table phase.
 Line: 1 Col: 68 Unexpected implied end tag (a) in the table phase.
 Line: 1 Col: 71 Expected closing tag. Unexpected end of file.
-
 #document
 | <html>
 |   <head>
@@ -1224,6 +1219,7 @@ Line: 1 Col: 47 Expected closing tag. Unexpected end of file.
 Line: 1 Col: 5 Unexpected start tag (wbr). Expected DOCTYPE.
 Line: 1 Col: 28 End tag (strike) violates step 1, paragraph 3 of the adoption agency algorithm.
 Line: 1 Col: 49 Unexpected end tag (code). Ignored.
+EOF
 #document
 | <html>
 |   <head>
@@ -1265,7 +1261,6 @@ Line: 1 Col: 7 Unexpected start tag (title). Expected DOCTYPE.
 <style><!--</style><meta><script>--><link></script>
 #errors
 Line: 1 Col: 7 Unexpected start tag (style). Expected DOCTYPE.
-Line: 1 Col: 51 Unexpected end of file. Expected end tag (style).
 #document
 | <html>
 |   <head>
@@ -1315,7 +1310,6 @@ Line: 1 Col: 48 Got table cell end tag (th) while required end tags are missing.
 Line: 1 Col: 6 Unexpected start tag (body). Expected DOCTYPE.
 Line: 1 Col: 12 Unexpected start tag (body).
 Line: 1 Col: 54 Unexpected start tag (body).
-Line: 1 Col: 64 Unexpected end tag (p). Missing end tag (body).
 #document
 | <html>
 |   <head>
@@ -1471,6 +1465,7 @@ Line: 1 Col: 21 End tag (a) violates step 1, paragraph 1 of the adoption agency
 #errors
 Line: 1 Col: 3 Unexpected start tag (b). Expected DOCTYPE.
 Line: 1 Col: 15 End tag (b) violates step 1, paragraph 1 of the adoption agency algorithm.
+EOF
 #document
 | <html>
 |   <head>
@@ -1610,7 +1605,8 @@ Line: 1 Col: 69 End tag (b) violates step 1, paragraph 3 of the adoption agency
 #data
 <ul><li><ul></li><li>a</li></ul></li></ul>
 #errors
-XXX: fix me
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -1795,10 +1791,11 @@ Line: 1 Col: 442 End tag (ul) seen too early. Expected other end tag.
 Line: 1 Col: 447 End tag (li) seen too early. Expected other end tag.
 Line: 1 Col: 454 End tag (nobr) violates step 1, paragraph 1 of the adoption agency algorithm.
 Line: 1 Col: 460 This element (wbr) has no end tag.
+</form>
 Line: 1 Col: 476 End tag (button) seen too early. Expected other end tag.
 Line: 1 Col: 486 End tag (marquee) seen too early. Expected other end tag.
 Line: 1 Col: 495 End tag (object) seen too early. Expected other end tag.
-Line: 1 Col: 513 Unexpected end tag (html). Ignored.
+after html: </frameset>
 Line: 1 Col: 513 Unexpected end tag (frameset). Ignored.
 Line: 1 Col: 520 Unexpected end tag (head). Ignored.
 Line: 1 Col: 529 Unexpected end tag (iframe). Ignored.
@@ -1915,10 +1912,11 @@ Line: 1 Col: 453 End tag (ul) seen too early. Expected other end tag.
 Line: 1 Col: 458 End tag (li) seen too early. Expected other end tag.
 Line: 1 Col: 465 End tag (nobr) violates step 1, paragraph 1 of the adoption agency algorithm.
 Line: 1 Col: 471 This element (wbr) has no end tag.
+</form>
 Line: 1 Col: 487 End tag (button) seen too early. Expected other end tag.
 Line: 1 Col: 497 End tag (marquee) seen too early. Expected other end tag.
 Line: 1 Col: 506 End tag (object) seen too early. Expected other end tag.
-Line: 1 Col: 524 Unexpected end tag (html). Ignored.
+after html: </frameset>
 Line: 1 Col: 524 Unexpected end tag (frameset). Ignored.
 Line: 1 Col: 531 Unexpected end tag (head). Ignored.
 Line: 1 Col: 540 Unexpected end tag (iframe). Ignored.
diff --git a/html/parsing/html5lib/html-tree/tests10.dat b/html/parsing/html5lib/html-tree/tests10.dat
index 4f8df86..8283f83 100644
--- a/html/parsing/html5lib/html-tree/tests10.dat
+++ b/html/parsing/html5lib/html-tree/tests10.dat
@@ -59,7 +59,6 @@
 <!DOCTYPE html><body><table><svg></svg></table>
 #errors
 34: Start tag “svg” seen in “table”.
-41: Stray end tag “svg”.
 #document
 | <!DOCTYPE html>
 | <html>
@@ -72,8 +71,6 @@
 <!DOCTYPE html><body><table><svg><g>foo</g></svg></table>
 #errors
 34: Start tag “svg” seen in “table”.
-46: Stray end tag “g”.
-53: Stray end tag “svg”.
 #document
 | <!DOCTYPE html>
 | <html>
@@ -88,9 +85,6 @@
 <!DOCTYPE html><body><table><svg><g>foo</g><g>bar</g></svg></table>
 #errors
 34: Start tag “svg” seen in “table”.
-46: Stray end tag “g”.
-58: Stray end tag “g”.
-65: Stray end tag “svg”.
 #document
 | <!DOCTYPE html>
 | <html>
@@ -107,9 +101,6 @@
 <!DOCTYPE html><body><table><tbody><svg><g>foo</g><g>bar</g></svg></tbody></table>
 #errors
 41: Start tag “svg” seen in “table”.
-53: Stray end tag “g”.
-65: Stray end tag “g”.
-72: Stray end tag “svg”.
 #document
 | <!DOCTYPE html>
 | <html>
@@ -127,9 +118,6 @@
 <!DOCTYPE html><body><table><tbody><tr><svg><g>foo</g><g>bar</g></svg></tr></tbody></table>
 #errors
 45: Start tag “svg” seen in “table”.
-57: Stray end tag “g”.
-69: Stray end tag “g”.
-76: Stray end tag “svg”.
 #document
 | <!DOCTYPE html>
 | <html>
@@ -225,6 +213,7 @@
 #data
 <!DOCTYPE html><body><table><caption><svg><g>foo</g><g>bar</g>baz</table><p>quux
 #errors
+</table> in foreign content
 78: “table” closed but “caption” was still open.
 78: Unclosed elements on stack.
 #document
@@ -247,10 +236,9 @@
 <!DOCTYPE html><body><table><colgroup><svg><g>foo</g><g>bar</g><p>baz</table><p>quux
 #errors
 44: Start tag “svg” seen in “table”.
-56: Stray end tag “g”.
-68: Stray end tag “g”.
 71: HTML start tag “p” in a foreign namespace context.
 71: Start tag “p” seen in “table”.
+"baz" in table
 #document
 | <!DOCTYPE html>
 | <html>
@@ -444,6 +432,9 @@
 #data
 <svg></path>
 #errors
+no DOCTYPE
+unexpected </path>
+EOF
 #document
 | <html>
 |   <head>
@@ -453,6 +444,9 @@
 #data
 <div><svg></div>a
 #errors
+no DOCTYPE
+</div> in foreign content
+no </svg> before </div>
 #document
 | <html>
 |   <head>
@@ -464,6 +458,9 @@
 #data
 <div><svg><path></div>a
 #errors
+no DOCTYPE
+</div> in foreign content
+no </path></svg> before </div>
 #document
 | <html>
 |   <head>
@@ -476,6 +473,9 @@
 #data
 <div><svg><path></svg><path>
 #errors
+no DOCTYPE
+no </path> before </svg>
+no </path> at EOF
 #document
 | <html>
 |   <head>
@@ -488,6 +488,10 @@
 #data
 <div><svg><path><foreignObject><math></div>a
 #errors
+no DOCTYPE
+</div> in foreign content
+unmatched </div>
+EOF
 #document
 | <html>
 |   <head>
@@ -502,6 +506,9 @@
 #data
 <div><svg><path><foreignObject><p></div>a
 #errors
+no DOCTYPE
+unmatched </div>
+EOF
 #document
 | <html>
 |   <head>
@@ -549,6 +556,7 @@
 #data
 <!DOCTYPE html><p><svg><desc><p>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -562,6 +570,7 @@
 #data
 <!DOCTYPE html><p><svg><title><p>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -575,6 +584,9 @@
 #data
 <div><svg><path><foreignObject><p></foreignObject><p>
 #errors
+no DOCTYPE
+unmatched </foreignObject>
+EOF
 #document
 | <html>
 |   <head>
@@ -589,6 +601,8 @@
 #data
 <math><mi><div><object><div><span></span></div></object></div></mi><mi>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -604,6 +618,8 @@
 #data
 <math><mi><svg><foreignObject><div><div></div></div></foreignObject></svg></mi><mi>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -619,6 +635,8 @@
 #data
 <svg><script></script><path>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -630,6 +648,9 @@
 #data
 <table><svg></svg><tr>
 #errors
+no DOCTYPE
+<svg> in table
+EOF
 #document
 | <html>
 |   <head>
@@ -642,6 +663,8 @@
 #data
 <math><mi><mglyph>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -653,6 +676,8 @@
 #data
 <math><mi><malignmark>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -664,6 +689,8 @@
 #data
 <math><mo><mglyph>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -675,6 +702,8 @@
 #data
 <math><mo><malignmark>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -686,6 +715,8 @@
 #data
 <math><mn><mglyph>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -697,6 +728,8 @@
 #data
 <math><mn><malignmark>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -708,6 +741,8 @@
 #data
 <math><ms><mglyph>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -719,6 +754,8 @@
 #data
 <math><ms><malignmark>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -730,6 +767,8 @@
 #data
 <math><mtext><mglyph>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -741,6 +780,8 @@
 #data
 <math><mtext><malignmark>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -752,6 +793,8 @@
 #data
 <math><annotation-xml><svg></svg></annotation-xml><mi>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -764,6 +807,8 @@
 #data
 <math><annotation-xml><svg><foreignObject><div><math><mi></mi></math><span></span></div></foreignObject><path></path></svg></annotation-xml><mi>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -782,6 +827,8 @@
 #data
 <math><annotation-xml><svg><foreignObject><math><mi><svg></svg></mi><mo></mo></math><span></span></foreignObject><path></path></svg></annotation-xml><mi>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tests14.dat b/html/parsing/html5lib/html-tree/tests14.dat
index b8713f8..b525ca9 100644
--- a/html/parsing/html5lib/html-tree/tests14.dat
+++ b/html/parsing/html5lib/html-tree/tests14.dat
@@ -55,6 +55,7 @@
 #data
 <!DOCTYPE html><html 123=456><html 789=012>
 #errors
+second <html>
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests15.dat b/html/parsing/html5lib/html-tree/tests15.dat
index 6ce1c0d..9a23248 100644
--- a/html/parsing/html5lib/html-tree/tests15.dat
+++ b/html/parsing/html5lib/html-tree/tests15.dat
@@ -45,7 +45,8 @@ Line: 2 Col: 4 Expected closing tag. Unexpected end of file.
 #data
 <!doctype html></html> <head>
 #errors
-Line: 1 Col: 22 Unexpected end tag (html) after the (implied) root element.
+after html: <head>
+in body: <head>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -68,7 +69,6 @@ Line: 1 Col: 22 Unexpected end tag (body) after the (implied) root element.
 <html></html><!-- foo -->
 #errors
 Line: 1 Col: 6 Unexpected start tag (html). Expected DOCTYPE.
-Line: 1 Col: 13 Unexpected end tag (html) after the (implied) root element.
 #document
 | <html>
 |   <head>
@@ -158,6 +158,7 @@ Line: 1 Col: 23 Unexpected non-space characters in table context caused voodoo m
 <!doctype html><div><table><a>foo</a> <tr><td>bar</td> </tr></table></div>
 #errors
 Line: 1 Col: 30 Unexpected start tag (a) in table context caused voodoo mode.
+"foo" in table
 Line: 1 Col: 37 Unexpected end tag (a) in table context caused voodoo mode.
 #document
 | <!DOCTYPE html>
@@ -179,13 +180,12 @@ Line: 1 Col: 37 Unexpected end tag (a) in table context caused voodoo mode.
 <frame></frame></frame><frameset><frame><frameset><frame></frameset><noframes></frameset><noframes>
 #errors
 6: Start tag seen without seeing a doctype first. Expected “<!DOCTYPE html>”.
-13: Stray start tag “frame”.
+13: Stray start g “frame”.
 21: Stray end tag “frame”.
 29: Stray end tag “frame”.
 39: “frameset” start tag after “body” already open.
 105: End of file seen inside an [R]CDATA element.
 105: End of file seen and there were open elements.
-XXX: These errors are wrong, please fix me!
 #document
 | <html>
 |   <head>
@@ -199,6 +199,7 @@ XXX: These errors are wrong, please fix me!
 #data
 <!DOCTYPE html><object></html>
 #errors
+</html> in <object>
 1: Expected closing tag. Unexpected end of file
 #document
 | <!DOCTYPE html>
diff --git a/html/parsing/html5lib/html-tree/tests16.dat b/html/parsing/html5lib/html-tree/tests16.dat
index c8ef66f..3844d23 100644
--- a/html/parsing/html5lib/html-tree/tests16.dat
+++ b/html/parsing/html5lib/html-tree/tests16.dat
@@ -108,6 +108,7 @@ Line: 1 Col: 30 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script></SCRIPT
 #errors
+EOF in tag
 Line: 1 Col: 31 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -120,6 +121,7 @@ Line: 1 Col: 31 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script></SCRIPT 
 #errors
+EOF in tag
 Line: 1 Col: 32 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -262,6 +264,7 @@ Line: 1 Col: 27 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--
 #errors
+EOF in escaped script data
 Line: 1 Col: 27 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -274,6 +277,7 @@ Line: 1 Col: 27 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--a
 #errors
+EOF in escaped script data
 Line: 1 Col: 28 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -286,6 +290,7 @@ Line: 1 Col: 28 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<
 #errors
+EOF in escaped script data
 Line: 1 Col: 28 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -298,6 +303,7 @@ Line: 1 Col: 28 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<a
 #errors
+EOF in escaped script data
 Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -310,6 +316,7 @@ Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--</
 #errors
+EOF in escaped script data
 Line: 1 Col: 27 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -322,6 +329,7 @@ Line: 1 Col: 27 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--</script
 #errors
+EOF in escaped script data
 Line: 1 Col: 35 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -334,6 +342,7 @@ Line: 1 Col: 35 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--</script 
 #errors
+EOF in escaped script data
 Line: 1 Col: 36 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -346,6 +355,7 @@ Line: 1 Col: 36 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<s
 #errors
+EOF in escaped script data
 Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -358,6 +368,7 @@ Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script
 #errors
+EOF in escaped script data
 Line: 1 Col: 34 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -370,6 +381,7 @@ Line: 1 Col: 34 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script 
 #errors
+unclosed tag
 Line: 1 Col: 35 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -382,6 +394,7 @@ Line: 1 Col: 35 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script <
 #errors
+unclosed tag
 Line: 1 Col: 36 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -394,6 +407,7 @@ Line: 1 Col: 36 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script <a
 #errors
+unclosed tag
 Line: 1 Col: 37 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -406,6 +420,7 @@ Line: 1 Col: 37 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </
 #errors
+unclosed tag
 Line: 1 Col: 37 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -418,6 +433,7 @@ Line: 1 Col: 37 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </s
 #errors
+unclosed tag
 Line: 1 Col: 38 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -430,6 +446,7 @@ Line: 1 Col: 38 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </script
 #errors
+unclosed tag
 Line: 1 Col: 43 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -442,6 +459,7 @@ Line: 1 Col: 43 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </scripta
 #errors
+unclosed tag
 Line: 1 Col: 44 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -454,6 +472,7 @@ Line: 1 Col: 44 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </script 
 #errors
+unclosed tag
 Line: 1 Col: 44 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -466,6 +485,7 @@ Line: 1 Col: 44 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </script>
 #errors
+unclosed tag
 Line: 1 Col: 44 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -478,6 +498,7 @@ Line: 1 Col: 44 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </script/
 #errors
+unclosed tag
 Line: 1 Col: 44 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -490,6 +511,7 @@ Line: 1 Col: 44 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </script <
 #errors
+unclosed tag
 Line: 1 Col: 45 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -502,6 +524,7 @@ Line: 1 Col: 45 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </script <a
 #errors
+unclosed tag
 Line: 1 Col: 46 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -514,6 +537,7 @@ Line: 1 Col: 46 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </script </
 #errors
+unclosed tag
 Line: 1 Col: 46 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -526,6 +550,7 @@ Line: 1 Col: 46 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </script </script
 #errors
+unclosed tag
 Line: 1 Col: 52 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -562,6 +587,7 @@ Line: 1 Col: 53 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script </script </script>
 #errors
+EOF in data
 #document
 | <!DOCTYPE html>
 | <html>
@@ -573,6 +599,7 @@ Line: 1 Col: 53 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script -
 #errors
+EOF in data
 Line: 1 Col: 36 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -585,6 +612,7 @@ Line: 1 Col: 36 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script -a
 #errors
+EOF in data
 Line: 1 Col: 37 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -597,6 +625,7 @@ Line: 1 Col: 37 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script -<
 #errors
+EOF in data
 Line: 1 Col: 37 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -609,6 +638,7 @@ Line: 1 Col: 37 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script --
 #errors
+EOF in data
 Line: 1 Col: 37 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -621,6 +651,7 @@ Line: 1 Col: 37 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script --a
 #errors
+EOF in data
 Line: 1 Col: 38 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -633,6 +664,7 @@ Line: 1 Col: 38 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script --<
 #errors
+EOF in data
 Line: 1 Col: 38 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -681,6 +713,7 @@ Line: 1 Col: 40 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script --></script
 #errors
+unclosed tag
 Line: 1 Col: 46 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -693,6 +726,7 @@ Line: 1 Col: 46 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script --></script 
 #errors
+unclosed tag
 Line: 1 Col: 47 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -816,6 +850,7 @@ Line: 1 Col: 47 Unexpected end of file. Expected end tag (script).
 #data
 <!doctype html><script><!--<script>--!></script>X
 #errors
+unclosed data
 Line: 1 Col: 49 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -841,6 +876,7 @@ Line: 1 Col: 59 Unexpected end tag (script).
 #data
 <!doctype html><script><!--<script></scr'+'ipt></script>X
 #errors
+unclosed data
 Line: 1 Col: 57 Unexpected end of file. Expected end tag (script).
 #document
 | <!DOCTYPE html>
@@ -1270,6 +1306,7 @@ Line: 1 Col: 16 Unexpected end of file. Expected end tag (script).
 <script></SCRIPT 
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in tag
 Line: 1 Col: 17 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1341,6 +1378,7 @@ Line: 1 Col: 15 Unexpected end of file. Expected end tag (script).
 <script></script
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in tag
 Line: 1 Col: 16 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1412,6 +1450,7 @@ Line: 1 Col: 12 Unexpected end of file. Expected end tag (script).
 <script><!--
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 12 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1424,6 +1463,7 @@ Line: 1 Col: 12 Unexpected end of file. Expected end tag (script).
 <script><!--a
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 13 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1436,6 +1476,7 @@ Line: 1 Col: 13 Unexpected end of file. Expected end tag (script).
 <script><!--<
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 13 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1448,6 +1489,7 @@ Line: 1 Col: 13 Unexpected end of file. Expected end tag (script).
 <script><!--<a
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 14 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1460,6 +1502,7 @@ Line: 1 Col: 14 Unexpected end of file. Expected end tag (script).
 <script><!--</
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 14 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1472,6 +1515,7 @@ Line: 1 Col: 14 Unexpected end of file. Expected end tag (script).
 <script><!--</script
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in tag
 Line: 1 Col: 20 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1484,6 +1528,7 @@ Line: 1 Col: 20 Unexpected end of file. Expected end tag (script).
 <script><!--</script 
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in tag
 Line: 1 Col: 21 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1496,6 +1541,7 @@ Line: 1 Col: 21 Unexpected end of file. Expected end tag (script).
 <script><!--<s
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 14 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1508,6 +1554,7 @@ Line: 1 Col: 14 Unexpected end of file. Expected end tag (script).
 <script><!--<script
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 19 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1520,6 +1567,7 @@ Line: 1 Col: 19 Unexpected end of file. Expected end tag (script).
 <script><!--<script 
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 20 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1532,6 +1580,7 @@ Line: 1 Col: 20 Unexpected end of file. Expected end tag (script).
 <script><!--<script <
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in tag
 Line: 1 Col: 21 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1544,6 +1593,7 @@ Line: 1 Col: 21 Unexpected end of file. Expected end tag (script).
 <script><!--<script <a
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in tag
 Line: 1 Col: 22 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1556,6 +1606,7 @@ Line: 1 Col: 22 Unexpected end of file. Expected end tag (script).
 <script><!--<script </
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in tag
 Line: 1 Col: 22 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1568,6 +1619,7 @@ Line: 1 Col: 22 Unexpected end of file. Expected end tag (script).
 <script><!--<script </s
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in tag
 Line: 1 Col: 23 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1580,6 +1632,7 @@ Line: 1 Col: 23 Unexpected end of file. Expected end tag (script).
 <script><!--<script </script
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in tag
 Line: 1 Col: 28 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1592,6 +1645,7 @@ Line: 1 Col: 28 Unexpected end of file. Expected end tag (script).
 <script><!--<script </scripta
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in tag
 Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1604,6 +1658,7 @@ Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 <script><!--<script </script 
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in tag
 Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1616,6 +1671,7 @@ Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 <script><!--<script </script>
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1628,6 +1684,7 @@ Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 <script><!--<script </script/
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1640,6 +1697,7 @@ Line: 1 Col: 29 Unexpected end of file. Expected end tag (script).
 <script><!--<script </script <
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 30 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1652,6 +1710,7 @@ Line: 1 Col: 30 Unexpected end of file. Expected end tag (script).
 <script><!--<script </script <a
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 31 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1664,6 +1723,7 @@ Line: 1 Col: 31 Unexpected end of file. Expected end tag (script).
 <script><!--<script </script </
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 31 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1676,6 +1736,7 @@ Line: 1 Col: 31 Unexpected end of file. Expected end tag (script).
 <script><!--<script </script </script
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 38 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1688,6 +1749,7 @@ Line: 1 Col: 38 Unexpected end of file. Expected end tag (script).
 <script><!--<script </script </script 
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 38 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1700,6 +1762,7 @@ Line: 1 Col: 38 Unexpected end of file. Expected end tag (script).
 <script><!--<script </script </script/
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 38 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1723,6 +1786,7 @@ Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
 <script><!--<script -
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 21 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1735,6 +1799,7 @@ Line: 1 Col: 21 Unexpected end of file. Expected end tag (script).
 <script><!--<script -a
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 22 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1747,6 +1812,7 @@ Line: 1 Col: 22 Unexpected end of file. Expected end tag (script).
 <script><!--<script --
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 22 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1759,6 +1825,7 @@ Line: 1 Col: 22 Unexpected end of file. Expected end tag (script).
 <script><!--<script --a
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 23 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1807,6 +1874,7 @@ Line: 1 Col: 25 Unexpected end of file. Expected end tag (script).
 <script><!--<script --></script
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 31 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1819,6 +1887,7 @@ Line: 1 Col: 31 Unexpected end of file. Expected end tag (script).
 <script><!--<script --></script 
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 32 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1942,6 +2011,7 @@ Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
 <script><!--<script>--!></script>X
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 34 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -1967,6 +2037,7 @@ Line: 1 Col: 44 Unexpected end tag (script).
 <script><!--<script></scr'+'ipt></script>X
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+EOF in data
 Line: 1 Col: 42 Unexpected end of file. Expected end tag (script).
 #document
 | <html>
@@ -2251,8 +2322,8 @@ Line: 1 Col: 45 Unexpected end tag (noembed).
 |     "-->"
 
 #data
-<!doctype html><table>
-
+| <!doctype html><table>
+| 
 #errors
 Line 2 Col 0 Unexpected end of file. Expected table content.
 #document
@@ -2287,6 +2358,7 @@ Line 1 Col 51 Expected closing tag. Unexpected end of file.
 #data
 <!doctype html><form><table></form><form></table></form>
 #errors
+</form> in table
 35: Stray end tag “form”.
 41: Start tag “form” seen in “table”.
 #document
diff --git a/html/parsing/html5lib/html-tree/tests17.dat b/html/parsing/html5lib/html-tree/tests17.dat
index 7b555f8..5d4bf49 100644
--- a/html/parsing/html5lib/html-tree/tests17.dat
+++ b/html/parsing/html5lib/html-tree/tests17.dat
@@ -1,6 +1,9 @@
 #data
 <!doctype html><table><tbody><select><tr>
 #errors
+<select> in table
+<tr> in <select>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -14,6 +17,9 @@
 #data
 <!doctype html><table><tr><select><td>
 #errors
+<select> in table
+<td> in select
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -28,6 +34,8 @@
 #data
 <!doctype html><table><tr><td><select><td>
 #errors
+no </select>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -43,6 +51,8 @@
 #data
 <!doctype html><table><tr><th><select><td>
 #errors
+no </select>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -58,6 +68,9 @@
 #data
 <!doctype html><table><caption><select><tr>
 #errors
+no </caption> before </tr>
+no </select> before implied </caption>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -72,6 +85,8 @@
 #data
 <!doctype html><select><tr>
 #errors
+<tr> in select
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -82,6 +97,8 @@
 #data
 <!doctype html><select><td>
 #errors
+<td> in select
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -92,6 +109,8 @@
 #data
 <!doctype html><select><th>
 #errors
+<th> in select
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -102,6 +121,8 @@
 #data
 <!doctype html><select><tbody>
 #errors
+<tbody> in select
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -112,6 +133,8 @@
 #data
 <!doctype html><select><thead>
 #errors
+<thead> in select
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -122,6 +145,8 @@
 #data
 <!doctype html><select><tfoot>
 #errors
+<tfoot> in select
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -132,6 +157,8 @@
 #data
 <!doctype html><select><caption>
 #errors
+<caption> in select
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests18.dat b/html/parsing/html5lib/html-tree/tests18.dat
index 680e1f0..4a4b5e1 100644
--- a/html/parsing/html5lib/html-tree/tests18.dat
+++ b/html/parsing/html5lib/html-tree/tests18.dat
@@ -1,6 +1,7 @@
 #data
 <!doctype html><plaintext></plaintext>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -12,6 +13,9 @@
 #data
 <!doctype html><table><plaintext></plaintext>
 #errors
+<plaintext> in table
+text in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -24,6 +28,9 @@
 #data
 <!doctype html><table><tbody><plaintext></plaintext>
 #errors
+<plaintext> in table
+text in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -37,6 +44,9 @@
 #data
 <!doctype html><table><tbody><tr><plaintext></plaintext>
 #errors
+<plaintext> in table
+text in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -51,6 +61,9 @@
 #data
 <!doctype html><table><tbody><tr><plaintext></plaintext>
 #errors
+<plaintext> in table
+text in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -65,6 +78,7 @@
 #data
 <!doctype html><table><td><plaintext></plaintext>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -80,6 +94,7 @@
 #data
 <!doctype html><table><caption><plaintext></plaintext>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -93,6 +108,7 @@
 #data
 <!doctype html><table><tr><style></script></style>abc
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -108,6 +124,7 @@
 #data
 <!doctype html><table><tr><script></style></script>abc
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -123,6 +140,7 @@
 #data
 <!doctype html><table><caption><style></script></style>abc
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -137,6 +155,8 @@
 #data
 <!doctype html><table><td><style></script></style>abc
 #errors
+no <tr>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -153,6 +173,7 @@
 #data
 <!doctype html><select><script></style></script>abc
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -166,6 +187,8 @@
 #data
 <!doctype html><table><select><script></style></script>abc
 #errors
+<select> in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -180,6 +203,8 @@
 #data
 <!doctype html><table><tr><select><script></style></script>abc
 #errors
+<select> in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -196,6 +221,7 @@
 #data
 <!doctype html><frameset></frameset><noframes>abc
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -219,6 +245,7 @@
 #data
 <!doctype html><frameset></frameset></html><noframes>abc
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -242,6 +269,7 @@
 #data
 <!doctype html><table><tr></tbody><tfoot>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -255,6 +283,8 @@
 #data
 <!doctype html><table><td><svg></svg>abc<td>
 #errors
+no <tr>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests19.dat b/html/parsing/html5lib/html-tree/tests19.dat
index 0d62f5a..6a850ee 100644
--- a/html/parsing/html5lib/html-tree/tests19.dat
+++ b/html/parsing/html5lib/html-tree/tests19.dat
@@ -1,6 +1,7 @@
 #data
 <!doctype html><math><mn DefinitionUrl="foo">
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -13,6 +14,7 @@
 #data
 <!doctype html><html></p><!--foo-->
 #errors
+unmatched </p>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -23,6 +25,7 @@
 #data
 <!doctype html><head></head></p><!--foo-->
 #errors
+unmatched </p>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -33,6 +36,7 @@
 #data
 <!doctype html><body><p><pre>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -44,6 +48,7 @@
 #data
 <!doctype html><body><p><listing>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -55,6 +60,7 @@
 #data
 <!doctype html><p><plaintext>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -66,6 +72,7 @@
 #data
 <!doctype html><p><h1>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -77,6 +84,8 @@
 #data
 <!doctype html><form><isindex>
 #errors
+no </form> before <isindex>
+isindex
 #document
 | <!DOCTYPE html>
 | <html>
@@ -87,6 +96,7 @@
 #data
 <!doctype html><isindex action="POST">
 #errors
+isindex
 #document
 | <!DOCTYPE html>
 | <html>
@@ -104,6 +114,7 @@
 #data
 <!doctype html><isindex prompt="this is isindex">
 #errors
+isindex
 #document
 | <!DOCTYPE html>
 | <html>
@@ -120,6 +131,7 @@
 #data
 <!doctype html><isindex type="hidden">
 #errors
+isindex
 #document
 | <!DOCTYPE html>
 | <html>
@@ -137,6 +149,7 @@
 #data
 <!doctype html><isindex name="foo">
 #errors
+isindex
 #document
 | <!DOCTYPE html>
 | <html>
@@ -153,6 +166,7 @@
 #data
 <!doctype html><ruby><p><rp>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -165,6 +179,8 @@
 #data
 <!doctype html><ruby><div><span><rp>
 #errors
+no </span></div> before <rp>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -178,6 +194,8 @@
 #data
 <!doctype html><ruby><div><p><rp>
 #errors
+no </div> before <rp>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -191,6 +209,7 @@
 #data
 <!doctype html><ruby><p><rt>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -203,6 +222,8 @@
 #data
 <!doctype html><ruby><div><span><rt>
 #errors
+no </span></div> before <rt>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -216,6 +237,8 @@
 #data
 <!doctype html><ruby><div><p><rt>
 #errors
+no </div> before <rt>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -229,6 +252,7 @@
 #data
 <!doctype html><math/><foo>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -240,6 +264,7 @@
 #data
 <!doctype html><svg/><foo>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -251,6 +276,7 @@
 #data
 <!doctype html><div></body><!--foo-->
 #errors
+no </div> before </body>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -262,6 +288,8 @@
 #data
 <!doctype html><h1><div><h3><span></h1>foo
 #errors
+</h1> closing <h3>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -276,6 +304,7 @@
 #data
 <!doctype html><p></h3>foo
 #errors
+unmatched </h3>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -287,6 +316,7 @@
 #data
 <!doctype html><h3><li>abc</h2>foo
 #errors
+</h2> closes <h3>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -300,6 +330,8 @@
 #data
 <!doctype html><table>abc<!--foo-->
 #errors
+"abc" in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -312,6 +344,7 @@
 #data
 <!doctype html><table>  <!--foo-->
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -324,6 +357,8 @@
 #data
 <!doctype html><table> b <!--foo-->
 #errors
+" b " in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -336,6 +371,7 @@
 #data
 <!doctype html><select><option><option>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -348,6 +384,7 @@
 #data
 <!doctype html><select><option></optgroup>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -359,6 +396,7 @@
 #data
 <!doctype html><select><option></optgroup>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -370,6 +408,7 @@
 #data
 <!doctype html><p><math><mi><p><h1>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -384,6 +423,7 @@
 #data
 <!doctype html><p><math><mo><p><h1>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -398,6 +438,7 @@
 #data
 <!doctype html><p><math><mn><p><h1>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -412,6 +453,7 @@
 #data
 <!doctype html><p><math><ms><p><h1>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -426,6 +468,7 @@
 #data
 <!doctype html><p><math><mtext><p><h1>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -440,6 +483,8 @@
 #data
 <!doctype html><frameset></noframes>
 #errors
+unmatched </noframes>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -449,6 +494,8 @@
 #data
 <!doctype html><html c=d><body></html><html a=b>
 #errors
+after html: <html>
+second <html>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -460,6 +507,8 @@
 #data
 <!doctype html><html c=d><frameset></frameset></html><html a=b>
 #errors
+after html: <html>
+second <html>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -491,6 +540,7 @@
 #data
 <!doctype html><html><frameset></frameset></html>abc
 #errors
+after html: "abc"
 #document
 | <!DOCTYPE html>
 | <html>
@@ -500,6 +550,7 @@
 #data
 <!doctype html><html><frameset></frameset></html><p>
 #errors
+after html: <p>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -509,6 +560,7 @@
 #data
 <!doctype html><html><frameset></frameset></html></p>
 #errors
+after html: </p>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -518,6 +570,8 @@
 #data
 <html><frameset></frameset></html><!doctype html>
 #errors
+no doctype
+doctype after html
 #document
 | <html>
 |   <head>
@@ -526,6 +580,7 @@
 #data
 <!doctype html><body><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -535,6 +590,8 @@
 #data
 <!doctype html><p><frameset><frame>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -545,6 +602,7 @@
 #data
 <!doctype html><p>a<frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -556,6 +614,8 @@
 #data
 <!doctype html><p> <frameset><frame>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -566,6 +626,8 @@
 #data
 <!doctype html><pre><frameset>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -576,6 +638,8 @@
 #data
 <!doctype html><listing><frameset>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -586,6 +650,7 @@
 #data
 <!doctype html><li><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -596,6 +661,7 @@
 #data
 <!doctype html><dd><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -606,6 +672,7 @@
 #data
 <!doctype html><dt><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -616,6 +683,8 @@
 #data
 <!doctype html><button><frameset>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -626,6 +695,8 @@
 #data
 <!doctype html><applet><frameset>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -636,6 +707,8 @@
 #data
 <!doctype html><marquee><frameset>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -646,6 +719,8 @@
 #data
 <!doctype html><object><frameset>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -656,6 +731,8 @@
 #data
 <!doctype html><table><frameset>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -666,6 +743,7 @@
 #data
 <!doctype html><area><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -676,6 +754,7 @@
 #data
 <!doctype html><basefont><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -686,6 +765,7 @@
 #data
 <!doctype html><bgsound><frameset>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -696,6 +776,7 @@
 #data
 <!doctype html><br><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -706,6 +787,7 @@
 #data
 <!doctype html><embed><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -716,6 +798,7 @@
 #data
 <!doctype html><img><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -726,6 +809,7 @@
 #data
 <!doctype html><input><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -736,6 +820,7 @@
 #data
 <!doctype html><keygen><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -746,6 +831,7 @@
 #data
 <!doctype html><wbr><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -756,6 +842,7 @@
 #data
 <!doctype html><hr><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -766,6 +853,7 @@
 #data
 <!doctype html><textarea></textarea><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -776,6 +864,7 @@
 #data
 <!doctype html><xmp></xmp><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -786,6 +875,7 @@
 #data
 <!doctype html><iframe></iframe><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -796,6 +886,7 @@
 #data
 <!doctype html><select></select><frameset>
 #errors
+frameset in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -806,6 +897,8 @@
 #data
 <!doctype html><svg></svg><frameset><frame>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -816,6 +909,8 @@
 #data
 <!doctype html><math></math><frameset><frame>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -826,6 +921,8 @@
 #data
 <!doctype html><svg><foreignObject><div> <frameset><frame>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -836,6 +933,8 @@
 #data
 <!doctype html><svg>a</svg><frameset><frame>
 #errors
+frameset in body
+frame in body
 #document
 | <!DOCTYPE html>
 | <html>
@@ -847,6 +946,8 @@
 #data
 <!doctype html><svg> </svg><frameset><frame>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -857,6 +958,9 @@
 #data
 <html>aaa<frameset></frameset>
 #errors
+no DOCTYPE
+frameset in body
+</frameset>
 #document
 | <html>
 |   <head>
@@ -866,6 +970,9 @@
 #data
 <html> a <frameset></frameset>
 #errors
+no DOCTYPE
+frameset in body
+</frameset>
 #document
 | <html>
 |   <head>
@@ -875,6 +982,8 @@
 #data
 <!doctype html><div><frameset>
 #errors
+frameset in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -884,6 +993,9 @@
 #data
 <!doctype html><div><body><frameset>
 #errors
+<body> in body
+<frameset> in body
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -894,6 +1006,8 @@
 #data
 <!doctype html><p><math></p>a
 #errors
+</p> in foreign
+no </math> before </p>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -906,6 +1020,8 @@
 #data
 <!doctype html><p><math><mn><span></p>a
 #errors
+unmatched </p>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -921,6 +1037,9 @@
 #data
 <!doctype html><math></html>
 #errors
+</html> in foreign
+no </math> before </html>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -966,6 +1085,7 @@
 #data
 <!doctype html><html a=b><head></head><html c=d>
 #errors
+second <html>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -977,6 +1097,7 @@
 #data
 <!doctype html><image/>
 #errors
+<image>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -987,6 +1108,15 @@
 #data
 <!doctype html>a<i>b<table>c<b>d</i>e</b>f
 #errors
+"c" in table
+<b> in table
+"d" in table
+</i> in table
+AAA at </i>
+"e" in table
+</b> in table
+"f" in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1003,6 +1133,21 @@
 #data
 <!doctype html><table><i>a<b>b<div>c<a>d</i>e</b>f
 #errors
+<i> in table
+"a" in table
+<b> in table
+"b" in table
+<div> in table
+"c" in table
+<a> in table
+"d" in table
+</i> in table
+AAA at </i>
+"e" in table
+</b> in table
+AAA at </b>
+"f" in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1028,6 +1173,9 @@
 #data
 <!doctype html><i>a<b>b<div>c<a>d</i>e</b>f
 #errors
+AAA at </i>
+AAA at </b>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1052,6 +1200,15 @@
 #data
 <!doctype html><table><i>a<b>b<div>c</i>
 #errors
+<i> in table
+"a" in table
+<b> in table
+"b" in table
+<div> in table
+"c" in table
+</i> in table
+AAA at </i>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1070,6 +1227,21 @@
 #data
 <!doctype html><table><i>a<b>b<div>c<a>d</i>e</b>f
 #errors
+<i> in table
+"a" in table
+<b> in table
+"b" in table
+<div> in table
+"c" in table
+<a> in table
+"d" in table
+</i> in table
+AAA at </i>
+"e" in table
+</b> in table
+AAA at </b>
+"f" in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1095,6 +1267,17 @@
 #data
 <!doctype html><table><i>a<div>b<tr>c<b>d</i>e
 #errors
+<i> in table
+"a" in table
+<div> in table
+"b" in table
+"c" in table
+<b> in table
+"d" in table
+</i> in table
+AAA at </i>
+"e" in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1117,6 +1300,17 @@
 #data
 <!doctype html><table><td><table><i>a<div>b<b>c</i>d
 #errors
+no <tr>
+<i> in table
+"a" in table
+<div> in table
+"b" in table
+<b> in table
+"c" in table
+</i> in table
+AAA at </i>
+"d" in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1160,6 +1354,7 @@
 #data
 <!doctype html><a><b></a><basefont>
 #errors
+no </b>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1172,6 +1367,7 @@
 #data
 <!doctype html><a><b></a><bgsound>
 #errors
+no </b>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1184,6 +1380,7 @@
 #data
 <!doctype html><figcaption><article></figcaption>a
 #errors
+no </article>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1196,6 +1393,7 @@
 #data
 <!doctype html><summary><article></summary>a
 #errors
+no </article>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1208,6 +1406,8 @@
 #data
 <!doctype html><p><a><plaintext>b
 #errors
+reconstruct at <plaintext>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -1222,6 +1422,8 @@
 #data
 <!DOCTYPE html><div>a<a></div>b<p>c</p>d
 #errors
+no </a>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests2.dat b/html/parsing/html5lib/html-tree/tests2.dat
index 60d8592..a10ff44 100644
--- a/html/parsing/html5lib/html-tree/tests2.dat
+++ b/html/parsing/html5lib/html-tree/tests2.dat
@@ -129,6 +129,7 @@ Line: 1 Col: 11 Unexpected end of file. Expected end tag (script).
 #errors
 Line: 1 Col: 7 Unexpected start tag (table). Expected DOCTYPE.
 Line: 1 Col: 18 Unexpected start tag (plaintext) in table context caused voodoo mode.
+text in table
 Line: 1 Col: 22 Unexpected end of file. Expected table content.
 #document
 | <html>
@@ -184,9 +185,7 @@ Line: 1 Col: 53 Unexpected start tag (body).
 </b test
 #errors
 Line: 1 Col: 8 Unexpected end of file in attribute name.
-Line: 1 Col: 8 End tag contains unexpected attributes.
 Line: 1 Col: 8 Unexpected end tag (b). Expected DOCTYPE.
-Line: 1 Col: 8 Unexpected end tag (b) after the (implied) root element.
 #document
 | <html>
 |   <head>
@@ -195,6 +194,7 @@ Line: 1 Col: 8 Unexpected end tag (b) after the (implied) root element.
 #data
 <!DOCTYPE html></b test<b &=&amp>X
 #errors
+no DOCTYPE
 Line: 1 Col: 32 Named entity didn't end with ';'.
 Line: 1 Col: 33 End tag contains unexpected attributes.
 Line: 1 Col: 33 Unexpected end tag (b) after the (implied) root element.
@@ -276,7 +276,6 @@ Line: 1 Col: 4 Unexpected non-space characters. Expected DOCTYPE.
 #data
 &x-test
 #errors
-Line: 1 Col: 1 Named entity expected. Got none.
 Line: 1 Col: 1 Unexpected non-space characters. Expected DOCTYPE.
 #document
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests20.dat b/html/parsing/html5lib/html-tree/tests20.dat
index 6bd8256..9084120 100644
--- a/html/parsing/html5lib/html-tree/tests20.dat
+++ b/html/parsing/html5lib/html-tree/tests20.dat
@@ -1,6 +1,8 @@
 #data
 <!doctype html><p><button><button>
 #errors
+button in button
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -13,6 +15,7 @@
 #data
 <!doctype html><p><button><address>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -25,6 +28,7 @@
 #data
 <!doctype html><p><button><blockquote>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -37,6 +41,7 @@
 #data
 <!doctype html><p><button><menu>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -49,6 +54,7 @@
 #data
 <!doctype html><p><button><p>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -61,6 +67,7 @@
 #data
 <!doctype html><p><button><ul>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -73,6 +80,7 @@
 #data
 <!doctype html><p><button><h1>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -85,6 +93,7 @@
 #data
 <!doctype html><p><button><h6>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -97,6 +106,7 @@
 #data
 <!doctype html><p><button><listing>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -109,6 +119,7 @@
 #data
 <!doctype html><p><button><pre>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -121,6 +132,7 @@
 #data
 <!doctype html><p><button><form>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -133,6 +145,7 @@
 #data
 <!doctype html><p><button><li>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -145,6 +158,7 @@
 #data
 <!doctype html><p><button><dd>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -157,6 +171,7 @@
 #data
 <!doctype html><p><button><dt>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -169,6 +184,7 @@
 #data
 <!doctype html><p><button><plaintext>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -181,6 +197,7 @@
 #data
 <!doctype html><p><button><table>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -193,6 +210,7 @@
 #data
 <!doctype html><p><button><hr>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -205,6 +223,8 @@
 #data
 <!doctype html><p><button><xmp>
 #errors
+EOF in xmp
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -217,6 +237,8 @@
 #data
 <!doctype html><p><button></p>
 #errors
+no <p>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -229,6 +251,7 @@
 #data
 <!doctype html><address><button></address>a
 #errors
+no </button>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -241,6 +264,7 @@
 #data
 <!doctype html><address><button></address>a
 #errors
+no </button>
 #document
 | <!DOCTYPE html>
 | <html>
@@ -253,6 +277,10 @@
 #data
 <p><table></p>
 #errors
+no DOCTYPE
+</p> in table
+no </p>
+EOF
 #document
 | <html>
 |   <head>
@@ -264,6 +292,7 @@
 #data
 <!doctype html><svg>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -274,6 +303,7 @@
 #data
 <!doctype html><p><figcaption>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -285,6 +315,7 @@
 #data
 <!doctype html><p><summary>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -296,6 +327,8 @@
 #data
 <!doctype html><form><table><form>
 #errors
+form in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -307,6 +340,9 @@
 #data
 <!doctype html><table><form><form>
 #errors
+form in table
+form in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -318,6 +354,8 @@
 #data
 <!doctype html><table><form></table><form>
 #errors
+form in table
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -329,6 +367,7 @@
 #data
 <!doctype html><svg><foreignObject><p>
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -341,6 +380,7 @@
 #data
 <!doctype html><svg><title>abc
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -353,6 +393,8 @@
 #data
 <option><span><option>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -364,6 +406,8 @@
 #data
 <option><option>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -374,6 +418,9 @@
 #data
 <math><annotation-xml><div>
 #errors
+no DOCTYPE
+<div> in foreign
+EOF
 #document
 | <html>
 |   <head>
@@ -385,6 +432,8 @@
 #data
 <math><annotation-xml encoding="application/svg+xml"><div>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -397,6 +446,8 @@
 #data
 <math><annotation-xml encoding="application/xhtml+xml"><div>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -409,6 +460,8 @@
 #data
 <math><annotation-xml encoding="aPPlication/xhtmL+xMl"><div>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -421,6 +474,8 @@
 #data
 <math><annotation-xml encoding="text/html"><div>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -433,6 +488,8 @@
 #data
 <math><annotation-xml encoding="Text/htmL"><div>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -445,6 +502,9 @@
 #data
 <math><annotation-xml encoding=" text/html "><div>
 #errors
+no DOCTYPE
+<div> in foreign
+EOF
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tests21.dat b/html/parsing/html5lib/html-tree/tests21.dat
index 1260ec0..3ea42f0 100644
--- a/html/parsing/html5lib/html-tree/tests21.dat
+++ b/html/parsing/html5lib/html-tree/tests21.dat
@@ -1,6 +1,8 @@
 #data
 <svg><![CDATA[foo]]>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -11,6 +13,8 @@
 #data
 <math><![CDATA[foo]]>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -21,6 +25,9 @@
 #data
 <div><![CDATA[foo]]>
 #errors
+no DOCTYPE
+bogus comment
+EOF
 #document
 | <html>
 |   <head>
@@ -31,6 +38,8 @@
 #data
 <svg><![CDATA[foo
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -41,6 +50,8 @@
 #data
 <svg><![CDATA[foo
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -51,6 +62,8 @@
 #data
 <svg><![CDATA[
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -60,6 +73,8 @@
 #data
 <svg><![CDATA[]]>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -69,6 +84,8 @@
 #data
 <svg><![CDATA[]] >]]>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -79,6 +96,8 @@
 #data
 <svg><![CDATA[]] >]]>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -89,6 +108,8 @@
 #data
 <svg><![CDATA[]]
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -99,6 +120,8 @@
 #data
 <svg><![CDATA[]
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -109,6 +132,8 @@
 #data
 <svg><![CDATA[]>a
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -119,6 +144,9 @@
 #data
 <svg><foreignObject><div><![CDATA[foo]]>
 #errors
+no DOCTYPE
+bogus comment
+EOF
 #document
 | <html>
 |   <head>
@@ -131,6 +159,8 @@
 #data
 <svg><![CDATA[<svg>]]>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -141,6 +171,8 @@
 #data
 <svg><![CDATA[</svg>a]]>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -151,6 +183,8 @@
 #data
 <svg><![CDATA[<svg>a
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -161,6 +195,8 @@
 #data
 <svg><![CDATA[</svg>a
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -171,6 +207,8 @@
 #data
 <svg><![CDATA[<svg>]]><path>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -182,6 +220,10 @@
 #data
 <svg><![CDATA[<svg>]]></path>
 #errors
+no DOCTYPE
+foreign </path>
+unmatched </path>
+EOF
 #document
 | <html>
 |   <head>
@@ -192,6 +234,8 @@
 #data
 <svg><![CDATA[<svg>]]><!--path-->
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -203,6 +247,8 @@
 #data
 <svg><![CDATA[<svg>]]>path
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
@@ -213,6 +259,8 @@
 #data
 <svg><![CDATA[<!--svg-->]]>
 #errors
+no DOCTYPE
+EOF
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tests22.dat b/html/parsing/html5lib/html-tree/tests22.dat
index aab27b2..a629119 100644
--- a/html/parsing/html5lib/html-tree/tests22.dat
+++ b/html/parsing/html5lib/html-tree/tests22.dat
@@ -1,6 +1,9 @@
 #data
 <a><b><big><em><strong><div>X</a>
 #errors
+no DOCTYPE
+AAA
+EOF
 #document
 | <html>
 |   <head>
@@ -20,6 +23,16 @@
 #data
 <a><b><div id=1><div id=2><div id=3><div id=4><div id=5><div id=6><div id=7><div id=8>A</a>
 #errors
+no DOCTYPE
+AAA 1
+AAA 2
+AAA 3
+AAA 4
+AAA 5
+AAA 6
+AAA 7
+AAA 8
+EOF
 #document
 | <html>
 |   <head>
@@ -56,6 +69,16 @@
 #data
 <a><b><div id=1><div id=2><div id=3><div id=4><div id=5><div id=6><div id=7><div id=8><div id=9>A</a>
 #errors
+no DOCTYPE
+AAA 1
+AAA 2
+AAA 3
+AAA 4
+AAA 5
+AAA 6
+AAA 7
+AAA 8
+EOF
 #document
 | <html>
 |   <head>
@@ -94,6 +117,16 @@
 #data
 <a><b><div id=1><div id=2><div id=3><div id=4><div id=5><div id=6><div id=7><div id=8><div id=9><div id=10>A</a>
 #errors
+no DOCTYPE
+AAA 1
+AAA 2
+AAA 3
+AAA 4
+AAA 5
+AAA 6
+AAA 7
+AAA 8
+EOF
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tests23.dat b/html/parsing/html5lib/html-tree/tests23.dat
index 34d2a73..5c34935 100644
--- a/html/parsing/html5lib/html-tree/tests23.dat
+++ b/html/parsing/html5lib/html-tree/tests23.dat
@@ -41,6 +41,9 @@
 #data
 <p><font size=4><font size=4><font size=4><font size=4><p>X
 #errors
+no DOCTYPE
+reconstruct
+EOF
 #document
 | <html>
 |   <head>
@@ -66,6 +69,9 @@
 #data
 <p><font size=4><font size=4><font size=4><font size="5"><font size=4><p>X
 #errors
+no DOCTYPE
+reconstruct
+EOF
 #document
 | <html>
 |   <head>
@@ -95,6 +101,9 @@
 #data
 <p><font size=4 id=a><font size=4 id=b><font size=4><font size=4><p>X
 #errors
+no DOCTYPE
+reconstruct
+EOF
 #document
 | <html>
 |   <head>
@@ -126,6 +135,10 @@
 #data
 <p><b id=a><b id=a><b id=a><b><object><b id=a><b id=a>X</object><p>Y
 #errors
+no DOCTYPE
+reconstruct
+reconstruct
+EOF
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tests25.dat b/html/parsing/html5lib/html-tree/tests25.dat
index 00de729..4ca113f 100644
--- a/html/parsing/html5lib/html-tree/tests25.dat
+++ b/html/parsing/html5lib/html-tree/tests25.dat
@@ -1,6 +1,7 @@
 #data
 <!DOCTYPE html><body><foo>A
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -78,13 +79,14 @@
 #data
 <!DOCTYPE html><body><command>A
 #errors
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
 |   <head>
 |   <body>
 |     <command>
-|     "A"
+|       "A"
 
 #data
 <!DOCTYPE html><body><embed>A
diff --git a/html/parsing/html5lib/html-tree/tests26.dat b/html/parsing/html5lib/html-tree/tests26.dat
index fae11ff..0b0b208 100644
--- a/html/parsing/html5lib/html-tree/tests26.dat
+++ b/html/parsing/html5lib/html-tree/tests26.dat
@@ -1,6 +1,16 @@
 #data
 <!DOCTYPE html><body><a href='#1'><nobr>1<nobr></a><br><a href='#2'><nobr>2<nobr></a><br><a href='#3'><nobr>3<nobr></a>
 #errors
+nobr in nobr
+reconstruct at <br>
+reconstruct at <a>
+nobr in nobr
+nobr in nobr
+reconstruct at <br>
+reconstruct at <a>
+nobr in nobr
+nobr in nobr
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -33,6 +43,13 @@
 #data
 <!DOCTYPE html><body><b><nobr>1<nobr></b><i><nobr>2<nobr></i>3
 #errors
+nobr in nobr
+AAA at </b>
+reconstruct at <i>
+nobr in nobr
+nobr in nobr
+AAA at </i>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -54,6 +71,24 @@
 #data
 <!DOCTYPE html><body><b><nobr>1<table><nobr></b><i><nobr>2<nobr></i>3
 #errors
+1:45:in table:nobr
+1:49:in table:/:b
+1:49:unmatched end tag:b
+1:52:in table:i
+1:58:in table:nobr
+1:58:in nobr:nobr
+1:58:in table:/:nobr
+1:58:not closed:i
+1:58:in table:nobr
+1:59:in table:\#text
+1:65:in table:nobr
+1:65:in nobr:nobr
+1:65:in table:/:nobr
+1:65:in table:nobr
+1:69:in table:/:i
+1:69:not closed:nobr
+1:69:in table:\#text
+1:69:in body:\#eof
 #document
 | <!DOCTYPE html>
 | <html>
@@ -75,6 +110,12 @@
 #data
 <!DOCTYPE html><body><b><nobr>1<table><tr><td><nobr></b><i><nobr>2<nobr></i>3
 #errors
+unmatched </b>
+<nobr> in nobr
+AAA at implied </nobr>
+<nobr> in nobr
+AAA at impied </i>
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -99,6 +140,15 @@
 #data
 <!DOCTYPE html><body><b><nobr>1<div><nobr></b><i><nobr>2<nobr></i>3
 #errors
+1:43:in nobr:nobr
+1:43:not closed:div
+1:47:not closed:nobr
+1:47:not closed:nobr
+1:56:in nobr:nobr
+1:56:not closed:i
+1:63:in nobr:nobr
+1:67:not closed:nobr
+1:67:in body:\#eof
 #document
 | <!DOCTYPE html>
 | <html>
@@ -123,6 +173,13 @@
 #data
 <!DOCTYPE html><body><b><nobr>1<nobr></b><div><i><nobr>2<nobr></i>3
 #errors
+1
+2
+3
+4
+5
+6
+7
 #document
 | <!DOCTYPE html>
 | <html>
@@ -145,6 +202,11 @@
 #data
 <!DOCTYPE html><body><b><nobr>1<nobr><ins></b><i><nobr>
 #errors
+1
+2
+3
+4
+5
 #document
 | <!DOCTYPE html>
 | <html>
@@ -163,6 +225,10 @@
 #data
 <!DOCTYPE html><body><b><nobr>1<ins><nobr></b><i>2
 #errors
+1
+2
+3
+4
 #document
 | <!DOCTYPE html>
 | <html>
@@ -180,6 +246,10 @@
 #data
 <!DOCTYPE html><body><b>1<nobr></b><i><nobr>2</i>
 #errors
+1
+2
+3
+4
 #document
 | <!DOCTYPE html>
 | <html>
@@ -195,9 +265,11 @@
 |         "2"
 
 #data
-<p><code x</code></p>
-
+| <p><code x</code></p>
+| 
 #errors
+AAA
+EOF
 #document
 | <html>
 |   <head>
@@ -215,11 +287,8 @@
 #data
 <!DOCTYPE html><svg><foreignObject><p><i></p>a
 #errors
-45: End tag “p” seen, but there were open elements.
-41: Unclosed element “i”.
-46: End of file seen and there were open elements.
-35: Unclosed element “foreignObject”.
-20: Unclosed element “svg”.
+AAA
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -235,12 +304,8 @@
 #data
 <!DOCTYPE html><table><tr><td><svg><foreignObject><p><i></p>a
 #errors
-56: End tag “p” seen, but there were open elements.
-52: Unclosed element “i”.
-57: End of file seen and there were open elements.
-46: Unclosed element “foreignObject”.
-31: Unclosed element “svg”.
-22: Unclosed element “table”.
+AAA
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -260,9 +325,8 @@
 #data
 <!DOCTYPE html><math><mtext><p><i></p>a
 #errors
-38: End tag “p” seen, but there were open elements.
-34: Unclosed element “i”.
-39: End of file in a foreign namespace context.
+AAA
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -278,9 +342,8 @@
 #data
 <!DOCTYPE html><table><tr><td><math><mtext><p><i></p>a
 #errors
-53: End tag “p” seen, but there were open elements.
-49: Unclosed element “i”.
-54: End of file in a foreign namespace context.
+AAA
+EOF
 #document
 | <!DOCTYPE html>
 | <html>
@@ -302,7 +365,6 @@
 #errors
 29: Bogus comment.
 34: End of file seen and there were open elements.
-26: Unclosed element “div”.
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests3.dat b/html/parsing/html5lib/html-tree/tests3.dat
index 38dc501..2884f7b 100644
--- a/html/parsing/html5lib/html-tree/tests3.dat
+++ b/html/parsing/html5lib/html-tree/tests3.dat
@@ -25,6 +25,7 @@ Line: 1 Col: 21 Unexpected start tag (script) that can be in head. Moved.
 #errors
 Line: 1 Col: 6 Unexpected start tag (head). Expected DOCTYPE.
 Line: 1 Col: 28 Unexpected start tag (style) that can be in head. Moved.
+script in head
 #document
 | <html>
 |   <head>
@@ -284,7 +285,6 @@ Line: 1 Col: 40 Expected closing tag. Unexpected end of file.
 #data
 <!doctype html><html><body><p><table></table></body></html>
 #errors
-Not known
 #document
 | <!DOCTYPE html>
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests4.dat b/html/parsing/html5lib/html-tree/tests4.dat
index 3c50632..0a6174c 100644
--- a/html/parsing/html5lib/html-tree/tests4.dat
+++ b/html/parsing/html5lib/html-tree/tests4.dat
@@ -41,7 +41,6 @@ plaintext
 #data
 setting html's innerHTML
 #errors
-Line: 1 Col: 24 Unexpected EOF in inner html mode.
 #document-fragment
 html
 #document
diff --git a/html/parsing/html5lib/html-tree/tests5.dat b/html/parsing/html5lib/html-tree/tests5.dat
index d7b5128..7091e98 100644
--- a/html/parsing/html5lib/html-tree/tests5.dat
+++ b/html/parsing/html5lib/html-tree/tests5.dat
@@ -2,7 +2,6 @@
 <style> <!-- </style>x
 #errors
 Line: 1 Col: 7 Unexpected start tag (style). Expected DOCTYPE.
-Line: 1 Col: 22 Unexpected end of file. Expected end tag (style).
 #document
 | <html>
 |   <head>
@@ -15,6 +14,7 @@ Line: 1 Col: 22 Unexpected end of file. Expected end tag (style).
 <style> <!-- </style> --> </style>x
 #errors
 Line: 1 Col: 7 Unexpected start tag (style). Expected DOCTYPE.
+unexpected </style>
 #document
 | <html>
 |   <head>
@@ -63,7 +63,9 @@ Line: 1 Col: 8 Unexpected start tag (iframe). Expected DOCTYPE.
 #data
 <iframe> <!--- </iframe>->x</iframe> --> </iframe>x
 #errors
-Line: 1 Col: 8 Unexpected start tag (iframe). Expected DOCTYPE.
+no DOCTYPE
+unexpected </iframe>
+unexpected </iframe>
 #document
 | <html>
 |   <head>
@@ -76,6 +78,7 @@ Line: 1 Col: 8 Unexpected start tag (iframe). Expected DOCTYPE.
 <script> <!-- </script> --> </script>x
 #errors
 Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
+unexpected </script>
 #document
 | <html>
 |   <head>
@@ -89,6 +92,7 @@ Line: 1 Col: 8 Unexpected start tag (script). Expected DOCTYPE.
 <title> <!-- </title> --> </title>x
 #errors
 Line: 1 Col: 7 Unexpected start tag (title). Expected DOCTYPE.
+unexpected </title>
 #document
 | <html>
 |   <head>
@@ -102,6 +106,8 @@ Line: 1 Col: 7 Unexpected start tag (title). Expected DOCTYPE.
 <textarea> <!--- </textarea>->x</textarea> --> </textarea>x
 #errors
 Line: 1 Col: 10 Unexpected start tag (textarea). Expected DOCTYPE.
+unexpected </textarea>
+unexpected </textarea>
 #document
 | <html>
 |   <head>
@@ -170,7 +176,6 @@ Line: 1 Col: 7 Unexpected start tag (title). Expected DOCTYPE.
 <title><!--</title>
 #errors
 Line: 1 Col: 7 Unexpected start tag (title). Expected DOCTYPE.
-Line: 1 Col: 19 Unexpected end of file. Expected end tag (title).
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tests6.dat b/html/parsing/html5lib/html-tree/tests6.dat
index f28ece4..ae4de7b 100644
--- a/html/parsing/html5lib/html-tree/tests6.dat
+++ b/html/parsing/html5lib/html-tree/tests6.dat
@@ -448,7 +448,6 @@ tr
 #errors
 Line: 1 Col: 7 Unexpected start tag (table). Expected DOCTYPE.
 Line: 1 Col: 16 Unexpected start tag (div) in table context caused voodoo mode.
-Line: 1 Col: 20 Unexpected implied end tag (div) in the table row phase.
 Line: 1 Col: 20 Expected closing tag. Unexpected end of file.
 #document
 | <html>
@@ -582,7 +581,6 @@ table
 <body></body></html>
 #errors
 Line: 1 Col: 20 Unexpected html end tag in inner html mode.
-Line: 1 Col: 20 Unexpected EOF in inner html mode.
 #document-fragment
 html
 #document
@@ -602,8 +600,8 @@ Line: 1 Col: 6 Unexpected start tag (html). Expected DOCTYPE.
 #data
 <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html></html>
 #errors
+#should
 Line: 1 Col: 50 Erroneous DOCTYPE.
-Line: 1 Col: 63 Unexpected end tag (html) after the (implied) root element.
 #document
 | <!DOCTYPE html "-//W3C//DTD HTML 4.01//EN" "">
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests7.dat b/html/parsing/html5lib/html-tree/tests7.dat
index f5193c6..29ed1a1 100644
--- a/html/parsing/html5lib/html-tree/tests7.dat
+++ b/html/parsing/html5lib/html-tree/tests7.dat
@@ -13,7 +13,6 @@
 <!doctype html><table><title>X</title></table>
 #errors
 Line: 1 Col: 29 Unexpected start tag (title) in table context caused voodoo mode.
-Line: 1 Col: 38 Unexpected end tag (title) in table context caused voodoo mode.
 #document
 | <!DOCTYPE html>
 | <html>
@@ -190,6 +189,7 @@ Line: 1 Col: 41 Unexpected input with type hidden in table context.
 <!doctype html><table>X<input type=hidDEN></table>
 #errors
 Line: 1 Col: 23 Unexpected non-space characters in table context caused voodoo mode.
+<input type=hidden> in table
 #document
 | <!DOCTYPE html>
 | <html>
@@ -232,6 +232,7 @@ Line: 1 Col: 45 Unexpected input with type hidden in table context.
 <!doctype html><table><input type=" hidden"><input type=hidDEN></table>
 #errors
 Line: 1 Col: 44 Unexpected start tag (input) in table context caused voodoo mode.
+<input type=hidden> in table
 #document
 | <!DOCTYPE html>
 | <html>
@@ -274,7 +275,6 @@ Line: 1 Col: 35 Unexpected end of file. Expected table content.
 #data
 <!DOCTYPE hTmL><html></html>
 #errors
-Line: 1 Col: 28 Unexpected end tag (html) after the (implied) root element.
 #document
 | <!DOCTYPE html>
 | <html>
@@ -284,7 +284,6 @@ Line: 1 Col: 28 Unexpected end tag (html) after the (implied) root element.
 #data
 <!DOCTYPE HTML><html></html>
 #errors
-Line: 1 Col: 28 Unexpected end tag (html) after the (implied) root element.
 #document
 | <!DOCTYPE html>
 | <html>
@@ -295,7 +294,6 @@ Line: 1 Col: 28 Unexpected end tag (html) after the (implied) root element.
 <body>X</body></body>
 #errors
 Line: 1 Col: 21 Unexpected end tag token (body) in the after body phase.
-Line: 1 Col: 21 Unexpected EOF in inner html mode.
 #document-fragment
 html
 #document
@@ -335,7 +333,10 @@ Line: 1 Col: 7 Unexpected start tag (table). Expected DOCTYPE.
 #data
 <table><b><tr><td>aaa</td></tr>bbb</table>ccc
 #errors
-XXX: Fix me
+<b> in table
+bbb in table
+<b> AAA
+EOF
 #document
 | <html>
 |   <head>
@@ -354,7 +355,9 @@ XXX: Fix me
 #data
 A<table><tr> B</tr> B</table>
 #errors
-XXX: Fix me
+no DOCTYPE
+"B" in table
+"B" in table
 #document
 | <html>
 |   <head>
@@ -367,7 +370,11 @@ XXX: Fix me
 #data
 A<table><tr> B</tr> </em>C</table>
 #errors
-XXX: Fix me
+no DOCTYPE
+"B" in table
+</em> in table
+unexpected </em>
+"C" in table
 #document
 | <html>
 |   <head>
@@ -381,7 +388,8 @@ XXX: Fix me
 #data
 <select><keygen>
 #errors
-Not known
+no DOCTYPE
+no </select>
 #document
 | <html>
 |   <head>
diff --git a/html/parsing/html5lib/html-tree/tests8.dat b/html/parsing/html5lib/html-tree/tests8.dat
index 90e6c91..9ae50d6 100644
--- a/html/parsing/html5lib/html-tree/tests8.dat
+++ b/html/parsing/html5lib/html-tree/tests8.dat
@@ -69,10 +69,13 @@ Line: 1 Col: 26 Expected closing tag. Unexpected end of file.
 #errors
 Line: 1 Col: 7 Unexpected start tag (table). Expected DOCTYPE.
 Line: 1 Col: 12 Unexpected start tag (div) in table context caused voodoo mode.
+"x" in table
 Line: 1 Col: 18 Unexpected start tag (div) in table context caused voodoo mode.
 Line: 1 Col: 24 Unexpected end tag (div) in table context caused voodoo mode.
+"x" in table
 Line: 1 Col: 32 Unexpected end tag (span) in table context caused voodoo mode.
 Line: 1 Col: 32 Unexpected end tag (span). Ignored.
+"x" in table
 Line: 1 Col: 33 Unexpected end of file. Expected table content.
 #document
 | <html>
diff --git a/html/parsing/html5lib/html-tree/tests9.dat b/html/parsing/html5lib/html-tree/tests9.dat
index 554e27a..e0470d2 100644
--- a/html/parsing/html5lib/html-tree/tests9.dat
+++ b/html/parsing/html5lib/html-tree/tests9.dat
@@ -74,7 +74,6 @@ Line: 1 Col: 50 Unexpected end tag (math) in the select phase. Ignored.
 <!DOCTYPE html><body><table><math></math></table>
 #errors
 Line: 1 Col: 34 Unexpected start tag (math) in table context caused voodoo mode.
-Line: 1 Col: 41 Unexpected end tag (math) in table context caused voodoo mode.
 #document
 | <!DOCTYPE html>
 | <html>
@@ -87,8 +86,7 @@ Line: 1 Col: 41 Unexpected end tag (math) in table context caused voodoo mode.
 <!DOCTYPE html><body><table><math><mi>foo</mi></math></table>
 #errors
 Line: 1 Col: 34 Unexpected start tag (math) in table context caused voodoo mode.
-Line: 1 Col: 46 Unexpected end tag (mi) in table context caused voodoo mode.
-Line: 1 Col: 53 Unexpected end tag (math) in table context caused voodoo mode.
+"foo" in table
 #document
 | <!DOCTYPE html>
 | <html>
@@ -103,9 +101,8 @@ Line: 1 Col: 53 Unexpected end tag (math) in table context caused voodoo mode.
 <!DOCTYPE html><body><table><math><mi>foo</mi><mi>bar</mi></math></table>
 #errors
 Line: 1 Col: 34 Unexpected start tag (math) in table context caused voodoo mode.
-Line: 1 Col: 46 Unexpected end tag (mi) in table context caused voodoo mode.
-Line: 1 Col: 58 Unexpected end tag (mi) in table context caused voodoo mode.
-Line: 1 Col: 65 Unexpected end tag (math) in table context caused voodoo mode.
+"foo" in table
+"bar" in table
 #document
 | <!DOCTYPE html>
 | <html>
@@ -122,9 +119,8 @@ Line: 1 Col: 65 Unexpected end tag (math) in table context caused voodoo mode.
 <!DOCTYPE html><body><table><tbody><math><mi>foo</mi><mi>bar</mi></math></tbody></table>
 #errors
 Line: 1 Col: 41 Unexpected start tag (math) in table context caused voodoo mode.
-Line: 1 Col: 53 Unexpected end tag (mi) in table context caused voodoo mode.
-Line: 1 Col: 65 Unexpected end tag (mi) in table context caused voodoo mode.
-Line: 1 Col: 72 Unexpected end tag (math) in table context caused voodoo mode.
+"foo" in table
+"bar" in table
 #document
 | <!DOCTYPE html>
 | <html>
@@ -142,9 +138,8 @@ Line: 1 Col: 72 Unexpected end tag (math) in table context caused voodoo mode.
 <!DOCTYPE html><body><table><tbody><tr><math><mi>foo</mi><mi>bar</mi></math></tr></tbody></table>
 #errors
 Line: 1 Col: 45 Unexpected start tag (math) in table context caused voodoo mode.
-Line: 1 Col: 57 Unexpected end tag (mi) in table context caused voodoo mode.
-Line: 1 Col: 69 Unexpected end tag (mi) in table context caused voodoo mode.
-Line: 1 Col: 76 Unexpected end tag (math) in table context caused voodoo mode.
+"foo" in table
+"bar" in table
 #document
 | <!DOCTYPE html>
 | <html>
@@ -240,6 +235,7 @@ Line: 1 Col: 81 Unexpected end table tag in caption. Generates implied end capti
 #data
 <!DOCTYPE html><body><table><caption><math><mi>foo</mi><mi>bar</mi>baz</table><p>quux
 #errors
+unmatched </table> in foreign content
 Line: 1 Col: 78 Unexpected end table tag in caption. Generates implied end caption.
 Line: 1 Col: 78 Unexpected end tag (caption). Missing end tag (math).
 #document
@@ -262,10 +258,11 @@ Line: 1 Col: 78 Unexpected end tag (caption). Missing end tag (math).
 <!DOCTYPE html><body><table><colgroup><math><mi>foo</mi><mi>bar</mi><p>baz</table><p>quux
 #errors
 Line: 1 Col: 44 Unexpected start tag (math) in table context caused voodoo mode.
-Line: 1 Col: 56 Unexpected end tag (mi) in table context caused voodoo mode.
-Line: 1 Col: 68 Unexpected end tag (mi) in table context caused voodoo mode.
+"foo" in table
+"bar" in table
 Line: 1 Col: 71 HTML start tag "p" in a foreign namespace context.
 Line: 1 Col: 71 Unexpected start tag (p) in table context caused voodoo mode.
+"baz" in table
 #document
 | <!DOCTYPE html>
 | <html>
